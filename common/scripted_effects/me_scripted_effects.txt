#Austrian Scripted Effects
HAB_change_habsburg_glory = { #amount
	tooltip = {
		[[remove]
			subtract_variable = {
				which = habsburg_glory
				value = $remove$
			}
		]
		[[amount]
			change_variable = {
				which = habsburg_glory
				value = $amount$
			}
		]
	}
	
	hidden_effect = {
		[[remove]
			subtract_variable = {
				which = habsburg_glory
				value = $remove$
			}
		]
		[[amount]
			change_variable = {
				which = habsburg_glory
				value = $amount$
			}
		]
		if = {
			limit = {
				check_variable = {
					which = habsburg_glory
					value = 101
				}
			}
			set_variable = {
				which = habsburg_glory
				value = 100
			}
		}
		
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = habsburg_glory
						value = 0
					}
				}
			}
			set_variable = {
				which = habsburg_glory
				value = 1
			}
		}
		HAB_determine_habsburg_glory_bonus = yes
	}
}

HAB_determine_habsburg_glory_bonus = {
	remove_country_modifier = HAB_habsburg_glory_21_40
	remove_country_modifier = HAB_habsburg_glory_41_60
	remove_country_modifier = HAB_habsburg_glory_61_80
	remove_country_modifier = HAB_habsburg_glory_81_100
	
	if = {
		limit = {
			check_variable = {
				which = habsburg_glory
				value = 81
			}
		}
		add_country_modifier = {
			name = HAB_habsburg_glory_81_100
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = habsburg_glory
				value = 61
			}
		}
		add_country_modifier = {
			name = HAB_habsburg_glory_61_80
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = habsburg_glory
				value = 41
			}
		}
		add_country_modifier = {
			name = HAB_habsburg_glory_41_60
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = habsburg_glory
				value = 21
			}
		}
		add_country_modifier = {
			name = HAB_habsburg_glory_21_40
			duration = -1
		}
	}
	else = { }
}

HAB_balkanize_poland_into_hre_effect = {
	#Deal with Polish subjects - the ones in the german region are to be released and the rest inherited. Leave Lithuania (they are important to the end)
	
	set_country_flag = me_hab_balkanized_poland
	
	$Poland$ = {
		every_subject_country = {
			limit = {
				NOT = {
					tag = LIT
				}
			}
			if = {
				limit = {
					capital_scope = {
						OR = {
							region = north_german_region
							region = south_german_region
						}
					}
				}
				grant_independence = yes
			}
			else = {
				overlord = {
					inherit = PREV
				}
			}
		}
		
		every_owned_province = { #Get rid of those provinces.
			limit = {
				OR = {
					region = north_german_region
					region = south_german_region
				}
			}
			random_core_country = {
				limit = {
					NOT = { exists = yes }
				}
				save_event_target_as = HAB_temp
				PREV = {
					$Poland$ = {
						release = event_target:HAB_temp
					}
				}
			} #try again
			if = {
				limit = {
					owned_by = $Poland$
				}
				random_core_country = {
					limit = {
						exists = yes
						is_part_of_hre = yes
					}
					every_core_province = {
						limit = {
							owned_by = $poland$
						}
						cede_province = PREV
					}
				}
			}
			#omg try again
			if = {
				limit = {
					owned_by = $Poland$
				}
				random_core_country = {
					limit = {
						exists = yes
					}
					every_core_province = {
						limit = {
							owned_by = $poland$
						}
						cede_province = PREV
					}
				}
			}
			#at this point I give up
		}
	}
	
	$Poland$ = {
		every_owned_province = {
			set_province_flag = HAB_set_hre
		}
	}
	#Now let us handle individual provinces
	if = {
		limit = {
			NOT = {
				exists = KRA
			}
		}
		262 = {
			if = {
				limit = {
					owned_by = $Poland$
				}
				add_core = KRA
			}
		}
		$Poland$ = { 
			release = KRA
		}
	}
	else = {
		262 = {
			add_core = LRP
		}
	}
	
	sandomierz_area = {
		limit = {
			owned_by = $Poland$
		}
		add_core = LRP
	}
	malopolska_area = {
		limit = {
			owned_by = $Poland$
		}
		add_core = LRP
	}
	
	$Poland$ = {
		release = LRP
	}
	
	4526 = {
		if = {
			limit = {
				owned_by = $Poland$
			}
			add_core = GNE
		}
	}
	4533 = {
		if = {
			limit = {
				owned_by = $Poland$
			}
			add_core = GNE
		}
	}
	258 = {
		if = {
			limit = {
				owned_by = $Poland$
			}
			add_core = GNE
		}
	}
	1939 = {
		if = {
			limit = {
				owned_by = $Poland$
			}
			add_core = GNE
		}
	}
	$Poland$ = {
		release = GNE
	}
	
	wielkopolska_area = {
		limit = {
			owned_by = $Poland$
		}
		add_core = GRP
	}
	
	2997 = {
		if = {
			limit = {
				owned_by = $Poland$
			}
			add_core = GRP
		}
	}
	
	$Poland$ = {
		release = GRP
	}
	
	if = {
		limit = {
			NOT = { 
				exists = MAZ
			}
		}
		mazovia_area = {
			limit = {
				owned_by = $Poland$
			}
			add_core = MAZ
		}
		red_ruthenia_area = {
			remove_core = MAZ
		}
	}
	$Poland$ = {
		release = MAZ
	}
	
	kuyavia_area = {
		limit = {
			owned_by = $Poland$
		}
		add_core = KUY
	}
	
	$Poland$ = {
		release = KUY
	}
	
	if = {
		limit = {
			NOT = { exists = DNZ }
		}
		43 = {
			if = {
				limit = {
					owned_by = $Poland$
				}
				add_core = DNZ
				$Poland$ = {
					release = DNZ
				}
			}
		}
	}
	else = {
		43 = {
			if = {
				limit = {
					owned_by = $Poland$
				}
				add_core = WRM
			}
		}
	}
	
	1841 = {
		if = {
			limit = { 
				owned_by = $Poland$
			}
			add_core = WRM
		}
	}
	42 = {
		if = {
			limit = { 
				owned_by = $Poland$
			}
			add_core = WRM
		}
	}
	
	$Poland$ = {
		release = WRM 
	}
	
	east_prussia_area = {
		limit = {
			owned_by = $Poland$
		}
		add_core = PRU
	}
	$Poland$ = {
		release = PRU
	}
	
	$Poland$ = {
		every_owned_province = {
			clr_province_flag = HAB_set_hre
		}
	}
	
	every_province = {
		limit = {
			has_province_flag = HAB_set_hre
		}
		clr_province_flag = HAB_set_hre
		set_in_empire = yes
		add_core = LIT
	}
	
	$Poland$ = {
		save_event_target_as = HAB_target_pol
	}
	WRM = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	GNE = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	LRP = {
		change_religion =  event_target:HAB_target_pol
		change_primary_culture =  event_target:HAB_target_pol
	}
	GRP = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	KUY = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	DNZ = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	PRU = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
	}
	MAZ = {
		change_religion = event_target:HAB_target_pol
		change_primary_culture = event_target:HAB_target_pol
		define_ruler = {
			name = "Bartlomiej I 'Zlewikk'"
			dynasty = "Zalewski"
			change_adm = 3
			change_dip = 3
			change_mil = 3
			max_random_adm = 3
			max_random_dip = 3
			max_random_mil = 3
			age = 20
			claim = 100
		}
		add_ruler_personality = me_enlightened_despote_personality
	}
	
	LIT = {
		inherit = $Poland$
		change_tag = PLC
	}
}

HAB_balkanize_france_into_hre_effect = {
	#copied from the above scripted effect
	
	
	set_global_flag = me_hab_balkanized_france
	
	$France$ = {
		every_subject_country = {
			if = {
				limit = {
					capital_scope = {
						OR = {
							region = north_german_region
							region = south_german_region
						}
					}
				}
				grant_independence = yes
			}
			else = {
				overlord = {
					inherit = PREV
				}
			}
		}
		
		every_owned_province = {
			set_in_empire = yes
		}
		every_owned_province = { #Get rid of those provinces.
			limit = {
				OR = {
					region = north_german_region
					region = south_german_region
				}
			}
			set_in_empire = yes
			random_core_country = {
				limit = {
					NOT = { exists = yes }
				}
				save_event_target_as = HAB_temp
				PREV = {
					$France$ = {
						release = event_target:HAB_temp
					}
				}
			}
		}
	}
	
	$France$ = {
		every_owned_province = {
			set_province_flag = HAB_set_hre
		}
	}
	#Now let us handle individual provinces
	if = {
		limit = {
			NOT = {
				exists = PIC
			}
		}
		picardy_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = PIC
				set_in_empire = yes
				remove_core = $France$
			}
		}
		$France$ = { 
			release = PIC
		}
		
		PIC = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = CHP
			}
		}
		picardy_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = CHP
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		185 = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = CHP
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		182 = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = CHP
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = CHP
		}
		
		CHP = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = NRM
			}
		}
		normandy_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = NRM
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = NRM
		}
		
		NRM = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = BRI
			}
		}
		brittany_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = BRI
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = BRI
		}
		
		BRI = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = PRO
			}
		}
		loire_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = PRO
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		poitou_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = PRO
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		provence_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = PRO
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = PRO
		}
		
		PRO = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = TOU
			}
		}
		languedoc_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = TOU
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = TOU
		}
		
		TOU = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = GUY
			}
		}
		guyenne_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = GUY
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		pyrenees_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = GUY
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		massif_central_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = GUY
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = GUY
		}
		
		GUY = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = DAU
			}
		}
		savoy_dauphine_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = DAU
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = DAU
		}
		
		DAU = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = ORL
			}
		}
		orleans_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = ORL
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = ORL
		}
		
		ORL = {
			change_religion = capital
		}
	}
	
	if = {
		limit = {
			NOT = {
				exists = BUR
			}
		}
		west_burgundy_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = BUR
				set_in_empire = yes
				remove_core = $France$
			}
		}
		bourgogne_area = {
			if = {
				limit = {
					owned_by = $France$
				}
				add_core = BUR
				set_in_empire = yes
				remove_core = $France$
			}
		}
		
		$France$ = { 
			release = BUR
		}
		
		BUR = {
			change_religion = capital
		}
	}
	
	
	$France$ = {
		every_owned_province = {
			clr_province_flag = HAB_set_hre
		}
	}
	
	every_owned_province = {
		set_in_empire = yes
	}
}

me_decrease_emperor_of_romans_level = {
	subtract_variable = {
		which = me_emperor_of_romans_level
		value = 1
	}
	if = {
		limit = {
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 0 } }
		}
		set_variable = { which = me_emperor_of_romans_level value = 0 }
	}
	if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 4 }
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 5 } }
		}
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_1
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 3 }
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 4 } }
		}
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_2
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 2 }
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 3 } }
		}
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_3
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 1 }
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 2 } }
		}
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_4
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 0 }
			NOT = { check_variable = { which = me_emperor_of_romans_level value = 1 } }
		}
		#Do absolutely nothing
	}
}

me_increase_emperor_of_romans_level = {
	change_variable = {
		which = me_emperor_of_romans_level
		value = 1
	}
	if = {
		limit = {
			check_variable = { which = me_emperor_of_romans_level value = 5 }
		}
		set_variable = { which = me_emperor_of_romans_level value = 4 }
	}
	if = {
		limit = {
			has_ruler_modifier = me_sty_emperor_of_romans_4
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans }
		}
		remove_country_modifier = me_sty_emperor_of_romans_4
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_3
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_modifier = me_sty_emperor_of_romans_3
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans }
		}
		remove_country_modifier = me_sty_emperor_of_romans_3
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_2
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_modifier = me_sty_emperor_of_romans_3
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans }
		}
		remove_country_modifier = me_sty_emperor_of_romans_3
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_2
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_modifier = me_sty_emperor_of_romans_2
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans }
		}
		remove_country_modifier = me_sty_emperor_of_romans_2
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_1
			duration = -1
		}
	}
	else_if = {
		limit = {
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans_1 }
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans_2 }
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans_3 }
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans_4 }
			NOT = { has_ruler_modifier = me_sty_emperor_of_romans }
		}
		add_ruler_modifier = {
			name = me_sty_emperor_of_romans_4
			duration = -1
		}
	}
}

#Hansa Scripted Effects
Hansa_complete_leadership_missions = {
	complete_mission = HSA_leadership
	complete_mission = HNS_leadership
}

#Hesse Schmalkaldic_Effects
HES_victory_effect = {
	emperor = {
		add_imperial_influence = -25
	}
	custom_tooltip = HES_every_protestant
	tooltip = {
		add_country_modifier = {
			name = HES_independent_schmalkaldic_league
			duration = 10950
		}
	}
	set_global_flag = HES_victory
}

HES_loss_effect = {
	emperor = {
		add_imperial_influence = 10
	}
	custom_tooltip = HES_every_catholic_prince
	tooltip = {
		add_country_modifier = {
			name = HES_loss_schmalkaldic_league
			duration = 10950
		}
	}
	set_global_flag = HES_loss
}

HES_disband_league = {
	hidden_effect = {
		every_country = {
			clr_country_flag = HES_refused #Nations that have refused to join/lead League
			clr_country_flag = HES_member #Nations that have declared participation in the League
			clr_country_flag = HES_invited #Nations that were invited - used for tooltips
			clr_country_flag = HES_proposed_leader #Special flag to skip the triggers of the beginning event
			clr_country_flag = HES_leader #Leader of the League - Emperor declares of him if there is one
			clr_country_flag = HES_emperor #The Emperor - nations leading the war against the league (doesn't have to be emperor)
		}
	}
}

HES_league_tooltip = {
	custom_tooltip = HES_being_part
	add_country_modifier = {
		name = HES_member_of_the_league
		duration = 10950
	}
	
	custom_tooltip = HES_beware
}

#Italian Missions Scripted Effects
complete_conquest_of_rome_missions = {
	hidden_effect = {
		complete_mission = gen_conquest_of_rome
		complete_mission = lvn_conquest_of_rome
		complete_mission = spi_conquest_of_rome
		complete_mission = tts_conquest_of_rome
		complete_mission = tus_conquest_of_rome
		complete_mission = fer_conquest_of_rome
		complete_mission = man_conquest_of_rome
		complete_mission = italian_minor_conquest_of_rome
		complete_mission = pga_conquest_of_rome
		complete_mission = vrn_conquest_of_rome
	}
}

#Korean Factionalism Scripted Effects
KOR_reset_factionalism = {
	hidden_effect = {
		remove_country_modifier = KOR_East
		remove_country_modifier = KOR_West
		remove_country_modifier = KOR_Hungu
		remove_country_modifier = KOR_Sarim
	}
	add_ruler_modifier = {
		name = KOR_$faction$
		duration = -1
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_modifier = KOR_empowered_$faction$
			}
			remove_country_modifier = KOR_empowered_East
			remove_country_modifier = KOR_empowered_West
			remove_country_modifier = KOR_empowered_Hungu
			remove_country_modifier = KOR_empowered_Sarim
			add_country_modifier = {
				name = KOR_empowered_$faction$
				duration = -1
			}
		}
		else = {
			remove_country_modifier = KOR_empowered_East
			remove_country_modifier = KOR_empowered_West
			remove_country_modifier = KOR_empowered_Hungu
			remove_country_modifier = KOR_empowered_Sarim
		}
		remove_country_modifier = KOR_recent_switch
	}
	add_country_modifier = {
		name = KOR_recent_switch
		duration = 1825
	}
}

KOR_add_modifier_for_current_faction = {
	if = {
		limit = {
			has_country_flag = KOR_extra_power
		}
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25
	}
	if = {
		limit = {
			has_country_modifier = KOR_East
		}
		add_country_modifier = {
			name = KOR_empowered_East
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_modifier = KOR_West
		}
		add_country_modifier = {
			name = KOR_empowered_West
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_modifier = KOR_Hungu
		}
		add_country_modifier = {
			name = KOR_empowered_Hungu
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_modifier = KOR_Sarim
		}
		add_country_modifier = {
			name = KOR_empowered_Sarim
			duration = -1
		}
	}
}

KOR_reform_event = {
	random_list = {
		#Equal chances
		16 = {
			country_event = { id = ME_Korea_Events.11 }
		}
		16 = {
			country_event = { id = ME_Korea_Events.12 }
		}
		16 = {
			country_event = { id = ME_Korea_Events.13 }
		}
		16 = {
			country_event = { id = ME_Korea_Events.14 }
		}
		16 = {
			country_event = { id = ME_Korea_Events.15 }
		}
		16 = {
			country_event = { id = ME_Korea_Events.16 }
		}
	}
}

KOR_generic_event = {
	random_list = {
		#Equal chances
		6 = {
			country_event = { id = ME_Korea_Events.17 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.18 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.19 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.20 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.21 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.22 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.23 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.24 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.25 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.26 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.27 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.28 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.29 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.30 }
		}
		6 = {
			country_event = { id = ME_Korea_Events.31 }
		}
	}
}

KOR_mad_event = {
	random_list = {
		#Equal chances
		33 = {
			country_event = { id = ME_Korea_Events.32 }
		}
		33 = {
			country_event = { id = ME_Korea_Events.33 }
		}
		33 = {
			country_event = { id = ME_Korea_Events.34 }
		}
	}
}

KOR_purge_event = {
	random_list = {
		#Equal chances
		33 = {
			country_event = { id = ME_Korea_Events.35 }
		}
		33 = {
			country_event = { id = ME_Korea_Events.36 }
		}
		33 = {
			country_event = { id = ME_Korea_Events.37 }
		}
	}
}
KOR_fire_event = {
	if = {
		limit = {
			OR = {
				innovativeness = 40
				innovativeness_ideas = 1
			}
		}
		country_event = {
			id = ME_Korea_Events.$id$
			days = 30
			random = $days$
		}
	}
	else = {
		country_event = {
			id = ME_Korea_Events.$id$
			days = $days$
			random = $days$
		}
	}
}

#Buildings Scripted Effects
# All is province scope here
## add/upgrade trade building in province
### add_or_upgrade_trade_building = yes  # feel free to refactor to include the amount of upgrades #might add custom tooltip later
add_or_upgrade_trade_building = {
	custom_tooltip = add_or_upgrade_trade_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = marketplace
			}
			add_building = trade_depot
		}
		else_if = {
			limit = {
				has_building = trade_depot
			}
			add_building = stock_exchange
		}
		else_if = {
			limit = {
				has_building = stock_exchange
			}
			add_base_tax = 1
			add_base_production = 1
		}
		else = {
			add_building = marketplace
		}
	}
}

add_or_upgrade_tax_building = {
	custom_tooltip = add_or_upgrade_tax_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = temple
			}
			add_building = cathedral
		}
		else_if = {
			limit = {
				has_building = cathedral
			}
			add_base_tax = 2
		}
		else = {
			add_building = temple
		}
	}
}

add_or_upgrade_production_building = {
	custom_tooltip = add_or_upgrade_production_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = workshop
			}
			add_building = counting_house
		}
		else_if = {
			limit = {
				has_building = counting_house
			}
			add_base_production = 2
		}
		else = {
			add_building = workshop
		}
	}
}

add_or_upgrade_dock_building = {
	custom_tooltip = add_or_upgrade_dock_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = dock
			}
			add_building = drydock
		}
		else_if = {
			limit = {
				has_building = drydock
			}
			ROOT = { add_sailors = 0.5 }
		}
		else = {
			add_building = dock
		}
	}
}

add_or_upgrade_shipyard_building = {
	custom_tooltip = add_or_upgrade_shipyard_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = shipyard
			}
			add_building = grand_shipyard 
		}
		else_if = {
			limit = {
				has_building = grand_shipyard 
			}
			ROOT = { add_sailors = 0.5 }
		}
		else = {
			add_building = shipyard
		}
	}
}

add_or_upgrade_manpower_building = {
	custom_tooltip = add_or_upgrade_manpower_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = barracks
			}
			add_building = training_fields  
		}
		else_if = {
			limit = {
				has_building = training_fields  
			}
			add_base_tax = 1
			add_base_manpower = 1
		}
		else = {
			add_building = barracks
		}
	}
}

add_or_upgrade_forcelimit_building = {
	custom_tooltip = add_or_upgrade_forcelimit_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = regimental_camp
			}
			add_building = conscription_center   
		}
		else_if = {
			limit = {
				has_building = conscription_center   
			}
			add_base_manpower = 2
		}
		else = {
			add_building = regimental_camp
		}
	}
}

add_or_upgrade_university_building = {
	custom_tooltip = add_or_upgrade_university_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = university
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
		else = {
			add_building = university
		}
	}
}

add_or_upgrade_courthouse_building = {
	custom_tooltip = add_or_upgrade_courthouse_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = courthouse
			}
			add_building = town_hall   
		}
		else_if = {
			limit = {
				has_building = town_hall   
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
		else = {
			add_building = courthouse
		}
	}
}

add_or_upgrade_fort_building = {
	custom_tooltip = add_or_upgrade_fort_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = fort_15th
			}
			add_building = fort_16th
		}
		else_if = {
			limit = {
				has_building = fort_16th
			}
			add_building = fort_17th
		}
		else_if = {
			limit = {
				has_building = fort_17th
			}
			add_building = fort_18th
		}
		else_if = {
			limit = {
				has_building = fort_18th
			}
			add_base_manpower = 3
		}
		else = {
			add_building = fort_15th
		}
	}
}

#Malayan Scripted Effects
MSA_start_expedition = {
	if = {
		limit = {
			is_capital = yes
		}
		owner = {
			set_country_flag = MSA_interest
			country_event = { id = ME_Malaya_Events.3 days = $delay$ }
			country_event = { id = ME_Malaya_Events.14 days = 1 random = 14 }
		}
	}
}

# $value$
MSA_change_china_loyalty = {
	change_variable = {
		which = Malaya_china_var
		value = $value$
	}
	
	if = {
		limit = {
			NOT = { has_country_flag = MSA_expedition_tooltip_off }
		}
		custom_tooltip = MSA_current_bonus
		MSA_determine_current_bonus = yes
		MSA_determine_future_bonus = { value = $value$ }
	}
	
	hidden_effect = {
		if = {
			limit = {
				check_variable = {
					which = Malaya_china_var
					value = 100
				}
			}
			set_variable = {
				which = Malaya_china_var
				value = 100
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = Malaya_china_var
						value = 0
					}
				}
			}
			set_variable = {
				which = Malaya_china_var
				value = 0
			}
		}
	}
}

MSA_determine_current_bonus = {
	if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 80
			}
		}
		MSA_absolutely_loyal_bonus = { tooltip = yes }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 60
			}
		}
		MSA_swayed_bonus = { tooltip = yes }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 40
			}
		}
		MSA_neutral_bonus = { tooltip = yes }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 20
			}
		}
		MSA_in_defiance_bonus = { tooltip = yes }
	}
	else = {
		MSA_insulting_bonus = { tooltip = yes }
	}
}

MSA_determine_future_bonus = {
	if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = MSA_temp
					value = 0
				}
				change_variable = {
					which = MSA_temp
					which = Malaya_china_var
				}
				change_variable = {
					which = MSA_temp
					value = $value$
				}
				check_variable = {
					which = MSA_temp
					value = 80
				}
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = Malaya_china_var
						value = 80
					}
				}
			}
			custom_tooltip = MSA_bonus_will_change
			MSA_absolutely_loyal_bonus = { tooltip = yes }
		}
		else = { custom_tooltip = MSA_bonus_no_change }
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = MSA_temp
					value = 0
				}
				change_variable = {
					which = MSA_temp
					which = Malaya_china_var
				}
				change_variable = {
					which = MSA_temp
					value = $value$
				}
				check_variable = {
					which = MSA_temp
					value = 60
				}
			}
		}
		if = {
			limit = {
				NOT = {
					AND = {
						check_variable = {
							which = Malaya_china_var
							value = 60
						}
						NOT = {
							check_variable = {
								which = Malaya_china_var
								value = 80
							}
						}
					}
				}
			}
			custom_tooltip = MSA_bonus_will_change
			MSA_swayed_bonus = { tooltip = yes }
		}
		else = { custom_tooltip = MSA_bonus_no_change }
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = MSA_temp
					value = 0
				}
				change_variable = {
					which = MSA_temp
					which = Malaya_china_var
				}
				change_variable = {
					which = MSA_temp
					value = $value$
				}
				check_variable = {
					which = MSA_temp
					value = 40
				}
			}
		}
		if = {
			limit = {
				NOT = {
					AND = {
						check_variable = {
							which = Malaya_china_var
							value = 40
						}
						NOT = {
							check_variable = {
								which = Malaya_china_var
								value = 60
							}
						}
					}
				}
			}
			custom_tooltip = MSA_bonus_will_change
			MSA_neutral_bonus = { tooltip = yes }
		}
		else = { custom_tooltip = MSA_bonus_no_change }
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = MSA_temp
					value = 0
				}
				change_variable = {
					which = MSA_temp
					which = Malaya_china_var
				}
				change_variable = {
					which = MSA_temp
					value = $value$
				}
				check_variable = {
					which = MSA_temp
					value = 20
				}
			}
		}
		if = {
			limit = {
				NOT = {
					AND = {
						check_variable = {
							which = Malaya_china_var
							value = 20
						}
						NOT = {
							check_variable = {
								which = Malaya_china_var
								value = 40
							}
						}
					}
				}
			}
			custom_tooltip = MSA_bonus_will_change
			MSA_in_defiance_bonus = { tooltip = yes }
		}
		else = { custom_tooltip = MSA_bonus_no_change }
	}
	else = {
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = Malaya_china_var
						value = 20
					}
				}
			}
			custom_tooltip = MSA_bonus_will_change
			MSA_insulting_bonus = { tooltip = yes }
		}
		else = { custom_tooltip = MSA_bonus_no_change }
	}
}

MSA_insulting_bonus = {
	[[tooltip] tooltip = { ]
		
	add_country_modifier = {
		name = MSA_insulting_modifier
		duration = 14600
	}
	set_country_flag = MSA_insulting_flag
	
	[[tooltip] } ]
}

MSA_in_defiance_bonus = {
	[[tooltip] tooltip = { ]
		
	add_country_modifier = {
		name = MSA_in_defiance_modifier
		duration = 10950
	}
	set_country_flag = MSA_in_defiance_flag
	
	[[tooltip] } ]
}

MSA_neutral_bonus = {
	[[tooltip] tooltip = { ]
		
	add_country_modifier = {
		name = MSA_neutral_modifier
		duration = 9125
	}
	set_country_flag = MSA_neutral_flag
	
	[[tooltip] } ]
}

MSA_swayed_bonus = {
	[[tooltip] tooltip = { ]
		
	add_country_modifier = {
		name = MSA_swayed_modifier
		duration = 9125
	}
	set_country_flag = MSA_swayed_flag
	
	[[tooltip] } ]
}

MSA_absolutely_loyal_bonus = {
	[[tooltip] tooltip = { ]
		
	add_country_modifier = {
		name = MSA_loyalty_modifier
		duration = 10950
	}
	set_country_flag = MSA_absolutely_loyal_flag
	[[tooltip] } ]
}

MSA_the_end = {
	clr_country_flag = MSA_chinese_expedition_in_tag
	set_country_flag = MSA_chinese_expedition_concluded
	if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 80
			}
		}
		MSA_absolutely_loyal_bonus = { }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 60
			}
		}
		MSA_swayed_bonus = { }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 40
			}
		}
		MSA_neutral_bonus = { }
	}
	else_if = {
		limit = {
			check_variable = {
				which = Malaya_china_var
				value = 20
			}
		}
		MSA_in_defiance_bonus = { }
	}
	else = {
		MSA_insulting_bonus = { }
	}
}

#all the randomization and logic behind the events being fired is in the below trigger
MSA_fire_event = {
	random_list = {
		100 = {
			trigger = {
				OR = {
					has_global_flag = MSA_fleet_one
					has_global_flag = MSA_fleet_two
					has_global_flag = MSA_fleet_three
				}
				NOT = { 
					check_variable = { 
						which = Malaya_china_var
						value = 35
					}
				}
				NOT = { num_of_cities = 5 }
				always = no
			}
			country_event = { id = ME_Malaya_Events.9 } #warlike-relations with the expedition, capture.
		}
		1 = {
			country_event = { id = ME_Malaya_Events.20 } #Extradition
		}
		1 = {
			country_event = { id = ME_Malaya_Events.21 } #Scandal at the Court
		}
		1 = {
			trigger = {
				NOT = {
					OR = {
						has_country_modifier = MSA_religion_respected
						has_country_modifier = MSA_religion_not_respected
					}
				}
			}
			country_event = { id = ME_Malaya_Events.22 } #Desecration of a Holy Site
		}
		1 = {
			country_event = { id = ME_Malaya_Events.23 } #Exotic Animals
		}
		1 = {
			country_event = { id = ME_Malaya_Events.24 } #Drunken Sailors
		}
		1 = {
			country_event = { id = ME_Malaya_Events.25 } #Religious Idol
		}
		1 = {
			trigger = {
				NOT = { has_country_modifier = MSA_free_trade }
			}
			country_event = { id = ME_Malaya_Events.26 } #Exploitative Costs
		}
		1 = {
			country_event = { id = ME_Malaya_Events.27 } #Nobles are worried
		}
		1 = {
			country_event = { id = ME_Malaya_Events.28 } #Translator's Dilemma
		}
		1 = {
			country_event = { id = ME_Malaya_Events.29 } #Locals dislike travellers
		}
		1 = {
			country_event = { id = ME_Malaya_Events.30 } #Map Sharing
		}
		1 = {
			country_event = { id = ME_Malaya_Events.31 } #Sailor Impressment
		}
		1 = {
			country_event = { id = ME_Malaya_Events.32 } #Displeased by Quality of Tribute
		}
		1 = {
			trigger = {
				check_variable = { 
					which = Malaya_china_var
					value = 80
				}
			}
			country_event = { id = ME_Malaya_Events.33 } #Hospitality Rewarded
		}
		1 = {
			trigger = {
				NOT = { has_country_modifier = MSA_form_of_defence }
			}
			country_event = { id = ME_Malaya_Events.34 } #Powerful Garrison
		}
		1 = {
			country_event = { id = ME_Malaya_Events.35 } #Displeased by Quality of Tribute
		}
		1 = {
			country_event = { id = ME_Malaya_Events.36 } #Foreign Drill Master
		}
		1 = {
			country_event = { id = ME_Malaya_Events.37 } #Gift - Porcelain
		}
		1 = {
			country_event = { id = ME_Malaya_Events.38 } #Gift - Silk
		}
		1 = {
			trigger = {
				NOT = { has_country_modifier = MSA_losing_wealth }
			}
			country_event = { id = ME_Malaya_Events.39 } #Ship repairs
		}
		1 = {
			country_event = { id = ME_Malaya_Events.40 } #Wisdom of the Generals
		}
		1 = {
			country_event = { id = ME_Malaya_Events.41 } #Invite to Further Travels
		}
		1 = {
			country_event = { id = ME_Malaya_Events.42 } #chinese trading post
		}
		1 = {
			trigger = {
				is_at_war = yes
			}
			country_event = { id = ME_Malaya_Events.43 } #Assistance in War
		}
		1 = {
			trigger = {
				NOT = { had_recent_war = 3 }
				NOT = { has_country_modifier = MSA_peaceful_ways }
			}
			country_event = { id = ME_Malaya_Events.44 } #Peaceful Ways
		}
	}
}

MSA_malay_missions = {
	hidden_effect = {
		complete_mission = MLC_malaya
		complete_mission = MLC_generic_malaya_generic
		complete_mission = PLB_srivijaya
		complete_mission = SUM_generic_alam_melayu 
		complete_mission = MKS_alam_melayu 
		complete_mission = TID_TER_alam_melayu
		complete_mission = PHI_alam_melayu
		complete_mission = BEI_alam_melayu
		complete_mission = PSA_ATJ_alam_melayu
		complete_mission = BEI_generic_alam_melayu
		complete_mission = MAJ_majapahit
		complete_mission = JAV_alam_melayu
		complete_mission = MSA_alam_melayu
	}
	set_country_flag = MSA_workaround #might be useful if above breaks again
	# custom_tooltip = MSA_workaround_set_tt
	change_national_focus_effect = yes
}

MSA_malaya_effect = {
	MSA_malay_missions = yes
	add_country_modifier = {
		name = MSA_malaya_unified
		duration = -1
	}
	custom_tooltip = MSA_accepted_culture_malay 
	tooltip = {
		add_province_modifier = {
			name = MSA_nation_of_malays
			duration = 7300
		}
	}
	hidden_effect = {
		every_owned_province = {
			limit = {
				culture_group = malay
				OR = {
					has_owner_accepted_culture = yes
					has_owner_culture = yes
				}
			}
			add_province_modifier = {
				name = MSA_nation_of_malays
				duration = 7300
			}
		}
	}
}

MSA_claims_java = {
	east_java_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	central_java_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	west_java_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_borneo = {
	brunei_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	sabah_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	kalimantan_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	palawan_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	kutai_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_malaya = {
	malacca_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	kedah_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	malaya_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	indonesian_islands_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_sulawesi = {
	south_sulawesi_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	sulawesi_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_sumatra = {
	minangkabau_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	north_sumatra_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	south_sumatra_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	batak_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	central_sumatra_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	palembang_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_spice_islands = {
	spice_islands_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	molluca_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_claims_philippines = {
	southern_luzon_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	luzon_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	visayas_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	mindanao_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
	sulu_archipelago_area = {
		limit = {
			NOT = { is_core = ROOT }
			NOT = { is_permanent_claim = ROOT }
		}
		add_permanent_claim = ROOT
	}
}

MSA_orang_laut_effect = {
	add_country_modifier = {
		name = MLC_orang_laut_alliances_modifier
		duration = -1
	}
	1361 = {
		add_trade_modifier = {
			who = ROOT
			duration = 5475
			power = 15
			key = MLC_orang_laut
		}
	}
	custom_tooltip = Orang_Laut_events
}

MSA_discover_tiwi = {
	ROOT = { discover_province = 1409 }
	ROOT = { discover_province = 1408 }
	ROOT = { discover_province = 1410 }
	ROOT = { discover_province = 2696 }
	ROOT = { discover_province = 2728 }
	ROOT = { discover_province = 2725 }
	ROOT = { discover_province = 635 }
}

MSA_load_province_flags = {
	if = {
		limit = {
			has_country_flag = TID_TER_can_load_all_provinces
		}
		MSA_load_ternate_claims = { tag = $tag$ }
		MSA_load_tidore_claims = { tag = $tag$ }
	}
	else_if = {
		limit = {
			tag = TID
		}
		MSA_load_tidore_claims = { tag = $tag$ }
	}
	else = {
		MSA_load_ternate_claims = { tag = $tag$ }
	}
}

MSA_load_ternate_claims = {
	648 = { set_province_flag = MSA_$tag$_claim } #shared
	647 = { set_province_flag = MSA_$tag$_claim } #shared
	2696 = { set_province_flag = MSA_$tag$_claim } #shared
	2717 = { set_province_flag = MSA_$tag$_claim } #shared
	645 = { set_province_flag = MSA_$tag$_claim } #shared
	646 = { set_province_flag = MSA_$tag$_claim } #shared
	633 = { set_province_flag = MSA_$tag$_claim }
	4796 = { set_province_flag = MSA_$tag$_claim }
	643 = { set_province_flag = MSA_$tag$_claim }
	2714 = { set_province_flag = MSA_$tag$_claim }
	2713 = { set_province_flag = MSA_$tag$_claim }
	644 = { set_province_flag = MSA_$tag$_claim }
	642 = { set_province_flag = MSA_$tag$_claim }
}

MSA_load_tidore_claims = {
	648 = { set_province_flag = MSA_$tag$_claim } #shared
	647 = { set_province_flag = MSA_$tag$_claim } #shared
	2696 = { set_province_flag = MSA_$tag$_claim } #shared
	2717 = { set_province_flag = MSA_$tag$_claim } #shared
	645 = { set_province_flag = MSA_$tag$_claim } #shared
	646 = { set_province_flag = MSA_$tag$_claim } #shared
	2724 = { set_province_flag = MSA_$tag$_claim }
	2725 = { set_province_flag = MSA_$tag$_claim }
	1245 = { set_province_flag = MSA_$tag$_claim }
	2718 = { set_province_flag = MSA_$tag$_claim }
}
	
MSA_MKS_load_province_flags = {
	4845 = { set_province_flag = MSA_MKS_claim }
	2714 = { set_province_flag = MSA_MKS_claim }
	2713 = { set_province_flag = MSA_MKS_claim }
	4796 = { set_province_flag = MSA_MKS_claim }
	643 = { set_province_flag = MSA_MKS_claim }
	644 = { set_province_flag = MSA_MKS_claim }
	632 = { set_province_flag = MSA_MKS_claim }
}

MSA_MKS_clear_province_flags = {
	4845 = { clr_province_flag = MSA_MKS_claim }
	2714 = { clr_province_flag = MSA_MKS_claim }
	2713 = { clr_province_flag = MSA_MKS_claim }
	4796 = { clr_province_flag = MSA_MKS_claim }
	643 = { clr_province_flag = MSA_MKS_claim }
	644 = { clr_province_flag = MSA_MKS_claim }
	632 = { clr_province_flag = MSA_MKS_claim }
}

MSA_clear_flags = {
	648 = { clr_province_flag = MSA_$tag$_claim } #shared
	647 = { clr_province_flag = MSA_$tag$_claim } #shared
	2696 = { clr_province_flag = MSA_$tag$_claim } #shared
	2717 = { clr_province_flag = MSA_$tag$_claim } #shared
	645 = { clr_province_flag = MSA_$tag$_claim } #shared
	646 = { clr_province_flag = MSA_$tag$_claim } #shared
	2724 = { clr_province_flag = MSA_$tag$_claim }
	2725 = { clr_province_flag = MSA_$tag$_claim }
	1245 = { clr_province_flag = MSA_$tag$_claim }
	2718 = { clr_province_flag = MSA_$tag$_claim }
	633 = { clr_province_flag = MSA_$tag$_claim }
	4796 = { clr_province_flag = MSA_$tag$_claim }
	643 = { clr_province_flag = MSA_$tag$_claim }
	2714 = { clr_province_flag = MSA_$tag$_claim }
	2713 = { clr_province_flag = MSA_$tag$_claim }
	644 = { clr_province_flag = MSA_$tag$_claim }
	642 = { clr_province_flag = MSA_$tag$_claim }
}

MSA_find_provinces_tag = {
	MSA_find_provinces = { target = 1 tag = $tag$ }
	if = {
		limit = { has_country_flag = TID_TER_1_province }
		MSA_find_provinces = { target = 2 tag = $tag$ }
		if = {
			limit = { has_country_flag = TID_TER_2_province }
			MSA_find_provinces = { target = 3 tag = $tag$ }
			if = {
				limit = { has_country_flag = TID_TER_3_province }
				MSA_find_provinces = { target = 4 tag = $tag$ }
				if = {
					limit = { has_country_flag = TID_TER_4_province }
					MSA_find_provinces = { target = 5 tag = $tag$ }
				}
			}
		}
	}
}

MSA_event_87_potential = {
	if = {
		limit = {
			NOT = { has_dlc = "Mandate of Heaven" }
		}
		MSA_87_find_provinces = { target = 1 goods = $goods$ }
		if = {
			limit = { has_country_flag = MSA_1_province }
			MSA_87_find_provinces = { target = 2 goods = $goods$ }
			if = {
				limit = { has_country_flag = MSA_2_province }
				MSA_87_find_provinces = { target = 3 goods = $goods$ }
				if = {
					limit = { has_country_flag = MSA_3_province }
					MSA_87_find_provinces = { target = 4 goods = $goods$ }
					if = {
						limit = { has_country_flag = MSA_1_province }
						MSA_87_find_provinces = { target = 5 goods = $goods$ }
					}
				}
			}
		}
	}
	else = {
		MSA_87_find_provinces = { target = 1 goods = $goods$ }
		if = {
			limit = { has_country_flag = MSA_1_province }
			MSA_87_find_provinces = { target = 2 goods = $goods$ }
			if = {
				limit = { has_country_flag = MSA_2_province }
				MSA_87_find_provinces = { target = 3 goods = $goods$ }
			}
		}
		if = {
			limit = { has_country_flag = MSA_3_province }
			MSA_87_find_provinces_state_edict = { target = 4 goods = $goods$ }
			if = {
				limit = { has_country_flag = MSA_1_province }
				MSA_87_find_provinces_state_edict = { target = 5 goods = $goods$ }
			}
		}
	}
}

MSA_87_find_provinces = {
	random_owned_province = {
		limit = {
			NOT = { has_province_flag = MSA_flag_already_set }
			NOT = { trade_goods = $goods$ }
			NOT = { has_state_edict = edict_advancement_effort }
		}
		save_event_target_as = Malaya_target_$target$
		set_province_flag = MSA_flag_already_set
		ROOT = { set_country_flag =  MSA_$target$_province }
	}
}

MSA_87_find_provinces_state_edict = {
	random_owned_province = {
		limit = {
			NOT = { has_province_flag = MSA_flag_already_set }
			NOT = { trade_goods = $goods$ }
			has_state_edict = edict_advancement_effort
		}
		save_event_target_as = Malaya_target_$target$
		set_province_flag = MSA_flag_already_set
		ROOT = { set_country_flag =  MSA_$target$_province }
	}
}

MSA_87_clr_flags = {
	every_owned_province = {
		clr_province_flag = MSA_flag_already_set
	}
	clr_country_flag = MSA_1_province
	clr_country_flag = MSA_2_province
	clr_country_flag = MSA_3_province
	clr_country_flag = MSA_4_province
	clr_country_flag = MSA_5_province
	clr_country_flag = MSA_cocoa_flag
	clr_country_flag = MSA_coffee_flag
}

MSA_87_execute_effect = {
	if = {
		limit = { has_country_flag = MSA_$id$_province }
		if = { 
			limit = {
				has_country_flag = MSA_cocoa_flag
			}
			event_target:Malaya_target_$id$ = {
				change_trade_goods = cocoa
			}
			hidden_effect = {
				subtract_variable = {
					which = MSA_cocoa_provinces
					value = 1
				}
			}
		}
		else_if = { 
			limit = {
				has_country_flag = MSA_coffee_flag
			}
			event_target:Malaya_target_$id$ = {
				change_trade_goods = coffee
			}
			hidden_effect = {
				subtract_variable = {
					which = MSA_coffee_provinces
					value = 1
				}
			}
		}
	}
}

MSA_find_provinces = {
	random_province = {
		limit = {
			has_province_flag = MSA_$tag$_claim
			is_empty = yes
		}
		save_event_target_as = Malaya_target_$target$
		clr_province_flag = MSA_$tag$_claim
		ROOT = { set_country_flag = TID_TER_$target$_province }
	}
}

MSA_set_up_province_targets = {
	MSA_find_provinces_concession_request = { target = 1 }
	if = {
		limit = { has_country_flag = MSA_1_province }
		MSA_find_provinces_concession_request = { target = 2 }
		if = {
			limit = { has_country_flag = MSA_2_province }
			MSA_find_provinces_concession_request = { target = 3 }
			if = {
				limit = { has_country_flag = MSA_3_province }
				MSA_find_provinces_concession_request = { target = 4 }
				if = {
					limit = { has_country_flag = MSA_4_province }
					MSA_find_provinces_concession_request = { target = 5 }
				}
			}
		}
	}
}

#flags
# MSA_coffee_choice
# MSA_plantation_choice
# 

MSA_execute_province_effect = {
	if = {
		limit = {
			owner = { has_country_flag = MSA_coffee_choice }
		}
		change_trade_goods = coffee
		add_province_modifier = {
			name = MSA_coffee
			duration = -1
		}
		owner = {
			MSA_this_will_cost = { amount = 15 execute = yes }
			set_country_flag = MSA_investment_c_cooldown
		}
	}
	else_if = {
		limit = {
			owner = { has_country_flag = MSA_plantation_choice }
		}
		add_province_modifier = {
			name = MSA_enhanced_spice_production
			duration = -1
		}
		owner = {
			MSA_this_will_cost = { amount = 20 execute = yes }
			set_country_flag = MSA_investment_g_cooldown
		}
	}
	else = {}
	# else_if = {
		# limit = {
			# owner = { has_country_flag = MSA_concession_province }
		# }
		# hidden_effect = {
			# change_variable = {
				# which = ME_Num_of_Foreign_Investments
				# value = -1
			# }
		# }
		
	# }
	
	owner = {
		MSA_clear_flags_province_choice = yes
		hidden_effect = {
			change_variable = {
				which = ME_Num_of_Foreign_Investments
				value = 1
			}
		}
	}
}

MSA_clear_flags_province_choice = {
	clr_country_flag = MSA_coffee_choice
	clr_country_flag = MSA_plantation_choice
	clr_country_flag = MSA_concession_province
	hidden_effect = {
		every_owned_province = {
			clr_province_flag = MSA_flag_already_set
		}
	}
}

MSA_find_provinces_concession_request = {
	if = {
		limit = {
			has_country_flag = MSA_coffee_choice
		}
		random_owned_province = {
			limit = {
				NOT = { has_province_flag = MSA_flag_already_set }
				NOT = { trade_goods = coffee }
				OR = {
					region = malaya_region
					region = indonesia_region
					region = moluccas_region 
				}
			}
			save_event_target_as = Malaya_target_$target$
			set_province_flag = MSA_flag_already_set
			ROOT = { set_country_flag = MSA_$target$_province }
		}
	}
	else_if = {
		limit = {
			has_country_flag = MSA_plantation_choice
		}
		if = {
			limit = {
				is_expanded_mod_active = { mod = trade_goods }
			}
			random_owned_province = {
				limit = {
					NOT = { has_province_flag = MSA_flag_already_set }
					OR = {
						trade_goods = cloves
						trade_goods = spices
						trade_goods = vanilla
						trade_goods = nutmeg
					}
					NOT = { has_province_modifier = MSA_enhanced_spice_production }
				}
				save_event_target_as = Malaya_target_$target$
				set_province_flag = MSA_flag_already_set
				ROOT = { set_country_flag = MSA_$target$_province }
			}
		}
		else = {
			random_owned_province = {
				limit = {
					NOT = { has_province_flag = MSA_flag_already_set }
					OR = {
						trade_goods = cloves
						trade_goods = spices
					}
					NOT = { has_province_modifier = MSA_enhanced_spice_production }
				}
				save_event_target_as = Malaya_target_$target$
				set_province_flag = MSA_flag_already_set
				ROOT = { set_country_flag = MSA_$target$_province }
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = MSA_concession_province
		}
		random_owned_province = {
			limit = {
				NOT = { has_province_flag = MSA_flag_already_set }
				province_has_center_of_trade_of_level = 1
			}
			save_event_target_as = Malaya_target_$target$
			set_province_flag = MSA_flag_already_set
			ROOT = { set_country_flag = MSA_$target$_province }
		}
	}
}

MSA_TID_TER_cost = { #funny. I use this for more than TID TER!
	if = {
		limit = {
			check_variable = { which = MSA_num_of_colonies value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = MSA_num_of_colonies value = 2 }
			}
			if = {
				limit = {
					check_variable = { which = MSA_num_of_colonies value = 3 }
				}
				if = {
					limit = {
						check_variable = { which = MSA_num_of_colonies value = 4 }
					}
					add_treasury = -150
				}
				else = { add_treasury = -125 }
			}
			else = { add_treasury = -100 }
		}
		else = { add_treasury = -75 }
	}
	else = { add_treasury = -50 }
	
	hidden_effect = {
		change_variable = {
			which = MSA_num_of_colonies
			value = 1
		}
	}
	clr_country_flag = TID_TER_flicked_decision
	set_country_flag = TID_TER_flicked_decision
}

MSA_sumatra_reward = {
	add_mercantilism = 2
	add_country_modifier = {
		name = MSA_legacy_of_srivijaya
		duration = 7300
	}
}

MSA_borneo_reward = {
	add_navy_tradition = 10
	add_country_modifier = {
		name = MSA_bruneian_thalassocracy_distrubed
		duration = 7300
	}
}

MSA_sulawesi_reward = {
	add_prestige_or_monarch_power = { amount = 10 }
	add_country_modifier = {
		name = MSA_island_of_iron
		duration = 9125
	}
}

MSA_java_reward = {
	add_army_tradition_or_mil_power = { amount = 10 }
	add_country_modifier = {
		name = MSA_majapahit_defeated
		duration = 10950
	}
}

MSA_malaya_reward = {
	add_stability_or_adm_power = yes
	1361 = {
		add_trade_modifier = {
			who = ROOT
			duration = 9125
			power = 25
			key = MSA_strait_secured
		}
	}
}

BEI_modifier_extension = {
	custom_tooltip = BEI_extend_or_add_humble_rise
	hidden_effect = {
		if = {
			limit = {
				any_owned_province = {
					has_province_modifier = BEI_humble_rise_to_greatness
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = BEI_humble_rise_to_greatness
				}
				extend_province_modifier = {
					name = BEI_humble_rise_to_greatness
					duration = 3650
				}
			}
		}
		else = {
			capital_scope = {
				add_province_modifier = {
					name = BEI_humble_rise_to_greatness
					duration = 3650
				}
			}
		}
	}
}

PSA_ATJ_modifier_extension = {
	custom_tooltip = PSA_ATJ_extend_holy_war
	hidden_effect = {
		if = {
			limit = {
				any_owned_province = {
					has_province_modifier = PSA_ATJ_holy_war
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = PSA_ATJ_holy_war
				}
				extend_province_modifier = {
					name = PSA_ATJ_holy_war
					duration = 3650
				}
			}
		}
		else = {
			capital_scope = {
				add_province_modifier = {
					name = PSA_ATJ_holy_war
					duration = 3650
				}
			}
		}
	}
}

MSA_spread_of_islam_route_spread = {
	set_global_flag = MSA_am_I_executed #we will use this flag to check if the algorithm produced a result for a province. If it will return negative, then the province will be marked as unavailable to save performance
	random_province = {
		limit = {
			province_has_center_of_trade_of_level = 1
			has_port = yes
			religion_group = muslim
			MSA_affected_by_spread_of_islam = yes
			OR = {
				NOT = { has_province_flag = MSA_spread_failed }
				had_province_flag = {
					flag = MSA_spread_failed
					days = 18250
				}
			}
		}
		
		save_event_target_as = MSA_origin_province_religion
		
		every_province = {
			limit = {
				province_has_center_of_trade_of_level = 1
				has_port = yes
				NOT = { religion_group = muslim }
				NOT = {
					province_distance = {
						who = PREV
						distance = 150 #number about right.
					}
				}
				MSA_affected_by_spread_of_islam = yes
				NOT = { 
					owner = {
						OR = {
							has_country_flag = MAJ_immunity_from_spread
							has_country_flag = MSA_restricted_trade_flag
						}
					}
				}
			}
			set_province_flag = MSA_in_reach
			clr_global_flag = MSA_am_I_executed
		}
		
		if = {
			limit = {
				has_global_flag = MSA_am_I_executed #we failed.
			}
			clr_global_flag = MSA_am_I_executed
			set_province_flag = MSA_spread_failed
			MSA_spread_of_islam_normal_spread = yes
		}
		else = {
			random_province = {
				limit = {
					has_province_flag = MSA_in_reach
				}
				save_event_target_as = MSA_target_province_religion
			}
			every_province = {
				limit = {
					has_province_flag = MSA_in_reach
				}
				clr_province_flag = MSA_in_reach
			}
		}
	}
}

MSA_spread_of_islam_normal_spread = { #land spread
	random_province = {
		limit = {
			religion_group = muslim
			MSA_affected_by_spread_of_islam = yes #areas and regions affected by malayan spread of islam
			any_neighbor_province = {
				NOT = { religion_group = muslim }
				NOT = { 
					owner = {
						OR = {
							has_country_flag = MAJ_immunity_from_spread
							has_country_flag = MSA_restricted_trade_flag
						}
					}
				}
			}
		}
		save_event_target_as = MSA_origin_province_religion
		random_neighbor_province = {
			limit = {
				NOT = { religion_group = muslim }
				NOT = { 
					owner = {
						OR = {
							has_country_flag = MAJ_immunity_from_spread
							has_country_flag = MSA_restricted_trade_flag
						}
					}
				}
			}
			save_event_target_as = MSA_target_province_religion
		}
	}
}

MSA_christian_spread_animist_dharmic = { #common spread, in the provinces not converted by islam yet
	set_global_flag = MSA_am_I_executed
	random_owned_province = {
		limit = {
			NOT = { religion_group = christian }
			OR = {
				religion_group = pagan
				religion_group = dharmic
			}
			culture_group = malay
		}
		save_event_target_as = MSA_province
		clr_global_flag = MSA_am_I_executed
	}
	
	random_owned_province = {
		limit = {
			NOT = { religion_group = christian }
			OR = {
				religion_group = pagan
				religion_group = dharmic
			}
			province_has_center_of_trade_of_level = 1
			culture_group = malay
		}
		save_event_target_as = MSA_province
		clr_global_flag = MSA_am_I_executed
	}
	
	if = {
		limit = { 
			has_global_flag = MSA_am_I_executed
		}
		clr_global_flag = MSA_am_I_executed
		MSA_christian_spread_center = yes
	}
}

MSA_christian_spread_center = { #the other spread.
	random_owned_province = {
		limit = {
			NOT = { religion_group = christian }
			culture_group = malay
			province_has_center_of_trade_of_level = 1
		}
		save_event_target_as = MSA_province
	}
	if = {
		limit = {
			if = {
				limit = { has_global_flag = MSA_spread_of_christianity_slow }
				num_of_owned_provinces_with = {
					religion_group = christian
					value = 6
				}
			}
			else = {
				num_of_owned_provinces_with = {
					religion_group = christian
					value = 12
				}
			}
		}
		clr_global_flag = MSA_spread_of_christianity
		country_event = { id = ME_Malaya_Events.77 }
	}
}

MSA_this_will_cost = {
	custom_tooltip = MSA_this_will_cost_$amount$
	[[execute]
		hidden_effect = {
			subtract_variable = {
				which = MSA_foreign_investment_amount
				value = $amount$
			}
		}
	]
}

MSA_find_lowest_tech_effect = {
	export_to_variable = {
		which = MSA_our_adm_tech
		value = adm_tech
	}
	export_to_variable = {
		which = MSA_our_dip_tech
		value = dip_tech
	}
	export_to_variable = {
		which = MSA_our_mil_tech
		value = mil_tech
	}
	set_variable = {
		which = MSA_our_lowest_tech
		which = MSA_our_adm_tech
	}
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = MSA_our_dip_tech
					which = MSA_our_lowest_tech
				}
			}
		}
		set_variable = {
			which = MSA_our_lowest_tech
			which = MSA_our_dip_tech
		}
	}
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = MSA_our_mil_tech
					which = MSA_our_lowest_tech
				}
			}
		}
		set_variable = {
			which = MSA_our_lowest_tech
			which = MSA_our_mil_tech
		}
	}
	
	subtract_variable = {
		which = MSA_our_adm_tech
		which = MSA_our_lowest_tech
	}
	subtract_variable = {
		which = MSA_our_dip_tech
		which = MSA_our_lowest_tech
	}
	subtract_variable = {
		which = MSA_our_mil_tech
		which = MSA_our_lowest_tech
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = MSA_our_adm_tech
				value = 0
			}
		}
		if = {
			limit = {
				is_variable_equal = {
					which = MSA_our_dip_tech
					value = 0
				}
			}
			if = {
				limit = {
					is_variable_equal = {
						which = MSA_our_mil_tech
						value = 0
					}
				}
				add_adm_power = 40
				add_dip_power = 40
				add_mil_power = 40
			}
			else = {
				add_adm_power = 60
				add_dip_power = 60
			}
		}
		else = {
			if = {
				limit = {
					is_variable_equal = {
						which = MSA_our_mil_tech
						value = 0
					}
				}
				add_adm_power = 60
				add_mil_power = 60
			}
			else = {
				add_adm_power = 120
			}
		}
	}
	else = {
		if = {
			limit = {
				is_variable_equal = {
					which = MSA_our_dip_tech
					value = 0
				}
			}
			if = {
				limit = {
					is_variable_equal = {
						which = MSA_our_mil_tech
						value = 0
					}
				}
				add_dip_power = 60
				add_mil_power = 60
			}
			else = {
				add_dip_power = 120
			}
		}
		else = {
			add_mil_power = 120
		}
	}
	
	#flush the vars
	set_variable = {
		which = MSA_our_adm_tech
		value = 0
	}
	set_variable = {
		which = MSA_our_dip_tech
		value = 0
	}
	set_variable = {
		which = MSA_our_mil_tech
		value = 0
	}
	set_variable = {
		which = MSA_our_lowest_tech
		value = 0
	}
}

MSA_expand_canton_effect = {
	if = {
		limit = {
			check_variable = {
				which = MSA_community_size
				value = 15
			}
		}
		add_mercantilism = 2
	}
	else = {
		custom_tooltip = MSA_cantonese_community_will_grow
		if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 14
				}
			}
			2160 = { #14
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 13
				}
			}
			2153 = { #14
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 12
				}
			}
			2163 = { #13
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 11
				}
			}
			670 = { #12
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 10
				}
			}
			669 = { #11
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 9
				}
			}
			2164 = { #10
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 8
				}
			}
			666 = { #9
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 7
				}
			}
			1840 = { #8
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 6
				}
			}
			1829 = { #7
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 5
				}
			}
			2156 = { #6
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 4
				}
			}
			2162 = { #5
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 3
				}
			}
			2161 = { #4
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 2
				}
			}
			2159 = { #3
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 1
				}
			}
			2158 = { #2
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		else = {
			2157 = { #1
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
		hidden_effect = {
			change_variable = {
				which = MSA_community_size
				value = 1
			}
		}
	}
}

MSA_shrink_canton_effect = {
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = MSA_community_size
					value = 1
				}
			}
		}
		add_mercantilism = -2
	}
	else = {
		custom_tooltip = MSA_cantonese_community_will_shrink
		if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 14
				}
			}
			2160 = { #14
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 13
				}
			}
			2153 = { #14
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 12
				}
			}
			2163 = { #13
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 11
				}
			}
			670 = { #12
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 10
				}
			}
			669 = { #11
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 9
				}
			}
			2164 = { #10
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 8
				}
			}
			666 = { #9
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 7
				}
			}
			1840 = { #8
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 6
				}
			}
			1829 = { #7
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 5
				}
			}
			2156 = { #6
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 4
				}
			}
			2162 = { #5
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 3
				}
			}
			2161 = { #4
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 2
				}
			}
			2159 = { #3
				remove_province_modifier = MSA_malay_community
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = MSA_community_size
					value = 1
				}
			}
			2158 = { #2
				remove_province_modifier = MSA_malay_community
			}
		}
		else = {
			2157 = { #1
				remove_province_modifier = MSA_malay_community
			}
		}
		hidden_effect = {
			subtract_variable = {
				which = MSA_community_size
				value = 1
			}
		}
	}
}

MSA_colonies_in_borneo = {
	2706 = {
		if = {
			limit = { is_empty = yes }
			add_siberian_construction = 100
		}
		else = { add_core = ROOT }
	}
	2708 = {
		if = {
			limit = { is_empty = yes }
			add_siberian_construction = 100
		}
		else = { add_core = ROOT }
	}
}

#Persian Scripted Effects
persia_indian_hegemony_decision_march_effect = {
	if = {
		limit = {
			owns = $province$
		}
		if = {
			limit = {
				NOT = { exists = $tag_1$ }
			}
			$tag_1$ = {
				custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_release_march
				hidden_effect = {
					save_event_target_as = persia_march_target
				}
			}
		}
		[[tag_2]
			else_if = {
				limit = {
					NOT = { exists = $tag_2$ }
				}
				$tag_2$ = {
					custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_release_march
					hidden_effect = {
						save_event_target_as = persia_march_target
					}
				}
			}
		]
		[[tag_3]
			else_if = {
				limit = {
					NOT = { exists = $tag_3$ }
				}
				$tag_3$ = {
					custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_release_march
					hidden_effect = {
						save_event_target_as = persia_march_target
					}
				}
			}
		]
		[[tag_4]
			else_if = {
				limit = {
					NOT = { exists = $tag_4$ }
				}
				$tag_4$ = {
					custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_release_march
					hidden_effect = {
						save_event_target_as = persia_march_target
					}
				}
			}
		]
		[[tag_5]
			else_if = {
				limit = {
					NOT = { exists = $tag_5$ }
				}
				$tag_5$ = {
					custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_release_march
					hidden_effect = {
						save_event_target_as = persia_march_target
					}
				}
			}
		]
		hidden_effect = {
			$province$ = {
				cede_province = event_target:persia_march_target
				add_core = event_target:persia_march_target
				add_unrest = -10
				if = {
					limit = {
						is_core = ROOT
					}
					remove_core = ROOT
				}
			}
			event_target:persia_march_target = {
				set_capital = $province$
				change_government = monarchy
				add_government_reform = feudalism_reform
				change_religion = ROOT
				$province$ = {
					PREV = { change_primary_culture = PREV }
				}
				if = {
					limit = {
						is_expanded_mod_active = { mod = subjects }
						ROOT = {
							can_create_subject_type = {
								subject = PREV
								subject_type = persian_satrapy
							}
						}
					}
					ROOT = {
						create_subject = {
							subject = PREV
							subject_type = persian_satrapy
						}
					}
				}
				else = {
					ROOT = {
						create_march = PREV
					}
				}
			}
		}
	}
	else = {
		random_subject_country = {
			limit = {
				owns = $province$
			}
			if = {
				limit = {
					is_expanded_mod_active = { mod = subjects }
					ROOT = {
						can_create_subject_type = {
							subject = PREV
							subject_type = persian_satrapy
						}
					}
				}
				ROOT = {
					create_subject = {
						subject = PREV
						subject_type = persian_satrapy
					}
				}
			}
			else = {
				ROOT = {
					create_march = PREV
				}
			}
			custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_cede_provinces_outside_of_tc_region
			hidden_effect = {
				save_event_target_as = persia_march_target
				every_owned_province = {
					limit = {
						NOT = { trade_company_region = $trade_company_region$ }
					}
					cede_province = ROOT
					if = {
						limit = {
							is_territorial_core = PREV
						}
						add_territorial_core = ROOT
						remove_core = PREV
					}
					else_if = {
						limit = {
							is_core = PREV
						}
						add_core = ROOT
						remove_core = PREV
					}
				}
			}
		}
	}
	custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_cede_tc_region
	custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_march_gets_claims
	custom_tooltip = persia_indian_hegemony_decision_march_$province$_tt_bonus_info
	hidden_effect = {
		event_target:persia_march_target = {
			set_country_flag = me_persia_indian_hegemony_mechanic_subject
		}
		$trade_company_region$ = {
			limit = {
				owned_by = ROOT
			}
			cede_province = event_target:persia_march_target
			if = {
				limit = {
					is_territorial_core = ROOT
				}
				add_territorial_core = event_target:persia_march_target
				remove_core = ROOT
			}
			else_if = {
				limit = {
					is_core = ROOT
				}
				add_core = event_target:persia_march_target
				remove_core = ROOT
			}
			event_target:persia_march_target = {
				add_liberty_desire = -1
			}
		}
		$trade_company_region$ = {
			limit = {
				NOT = { is_core = event_target:persia_march_target }
				NOT = { is_permanent_claim = event_target:persia_march_target }
			}
			add_permanent_claim = event_target:persia_march_target
		}
	}
}

persia_indian_hegemony_decision_coup_effect = {
	if = {
		limit = {
			monthly_income = 135
		}
		add_treasury = -5000
	}
	else = {
		add_years_of_income = -3
	}
	custom_tooltip = persia_indian_hegemony_decision_coup_tt_manpower_cost
	custom_tooltip = persia_indian_hegemony_decision_coup_tt_opinion_change
	hidden_effect = {
		export_to_variable = {
			which = manpower_to_pay_var
			value = max_manpower
		}
		multiply_variable = { which = manpower_to_pay_var value = 0.25 }
		while = {
			limit = {
				check_variable = { which = manpower_to_pay_var value = 1 }
			}
			add_manpower = -1
			change_variable = { which = manpower_to_pay_var value = -1 }
		}
		while = {
			limit = {
				check_variable = { which = manpower_to_pay_var value = 0.1 }
			}
			add_manpower = -0.1
			change_variable = { which = manpower_to_pay_var value = -0.1 }
		}
		set_variable = { which = manpower_to_pay_var value = 0 }
		every_country = {
			limit = {
				NOT = { is_subject_of = ROOT }
				capital_scope = {
					superregion = india_superregion
				}
			}
			add_opinion = {
				who = ROOT
				modifier = persia_coup_in_india
			}
		}
		$province$ = {
			owner = {
				save_event_target_as = persia_coup_target
			}
		}
	}
	if = {
		limit = {
			NOT = { exists = $tag_1$ }
		}
		$tag_1$ = {
			custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_independence
			hidden_effect = {
				save_event_target_as = persia_independence_target
			}
		}
	}
	[[tag_2]
		else_if = {
			limit = {
				NOT = { exists = $tag_2$ }
			}
			$tag_2$ = {
				custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_independence
				hidden_effect = {
					save_event_target_as = persia_independence_target
				}
			}
		}
	]
	[[tag_3]
		else_if = {
			limit = {
				NOT = { exists = $tag_3$ }
			}
			$tag_3$ = {
				custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_independence
				hidden_effect = {
					save_event_target_as = persia_independence_target
				}
			}
		}
	]
	[[tag_4]
		else_if = {
			limit = {
				NOT = { exists = $tag_4$ }
			}
			$tag_4$ = {
				custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_independence
				hidden_effect = {
					save_event_target_as = persia_independence_target
				}
			}
		}
	]
	[[tag_5]
		else_if = {
			limit = {
				NOT = { exists = $tag_5$ }
			}
			$tag_5$ = {
				custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_independence
				hidden_effect = {
					save_event_target_as = persia_independence_target
				}
			}
		}
	]
	custom_tooltip = persia_indian_hegemony_decision_coup_$province$_tt_war
	hidden_effect = {
		$province$ = {
			cede_province = event_target:persia_independence_target
			add_core = event_target:persia_independence_target
			add_unrest = -10
		}
		event_target:persia_independence_target = {
			set_capital = $province$
			change_government = monarchy
			add_government_reform = feudalism_reform
			$province$ = {
				PREV = {
					change_primary_culture = PREV
					change_religion = PREV
				}
			}
			capital_scope = {
				build_to_forcelimit = {
					infantry = 0.7
					cavalry = 0.2
					artillery = 0.1
				}
				region = {
					discover_country = event_target:persia_independence_target
					if = {
						limit = {
							has_port = yes
						}
						every_neighbor_sea_zone = {
							discover_country = event_target:persia_independence_target
						}
					}
				}
			}
			save_global_event_target_as = me_persia_indian_hegemony_mechanic_coup_target
			ROOT = {
				declare_war_with_cb = {
					who = event_target:persia_coup_target
					casus_belli = cb_persia_indian_hegemony_coup
				}
			}
			join_all_offensive_wars_of = ROOT
		}
		event_target:persia_coup_target = {
			country_event = { id = ME_Persia_Events.18 }
		}
	}
}

#Prussian Ascendance Missions
complete_prussian_ascendance_missions = {
	hidden_effect = {
		complete_mission = POM_prussian_glory
		complete_mission = BRA_prussian_ascendance
		complete_mission = TEU_prussian_ascendance
		complete_mission = PRU_prussian_ascendance
	}
}

#More ME Scripted Effects
# province scope
## add manufactory in scope
### build_possible_manufactory_in_province = yes
build_possible_manufactory_in_province = {
	custom_tooltip = BUILD_MATCHING_MANUFACTORY_IN_THIS_PROVINCE
	hidden_effect = {
		if = {
			limit = {
				has_no_manufactory_trigger = yes
			}
			if = {
				limit = {
					OR = {
						trade_goods = naval_supplies
						trade_goods = fish
						trade_goods = salt
					}
				}
				if = {
					limit = {
						ROOT = { dip_tech = 11 }
					}
					add_building = wharf
				}
				else = {
					ROOT = { add_dip_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = copper
						trade_goods = iron
					}
				}
				if = {
					limit = {
						ROOT = { mil_tech = 11 }
					}
					add_building = weapons
				}
				else = {
					ROOT = { add_mil_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = wool
						trade_goods = cloth
						trade_goods = silk
						trade_goods = dyes
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 11 }
					}
					add_building = textile
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = coffee
						trade_goods = cotton
						trade_goods = sugar
						trade_goods = tobacco
						trade_goods = tea
						trade_goods = cocoa
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 14 }
					}
					add_building = plantations
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = ivory
						trade_goods = slaves
						trade_goods = spices
						trade_goods = fur
						trade_goods = incense
					}
				}
				if = {
					limit = {
						ROOT = { dip_tech = 14 }
					}
					add_building = tradecompany
				}
				else = {
					ROOT = { add_dip_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = livestock
						trade_goods = wine
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 6 }
					}
					add_building = farm_estate
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = paper
						trade_goods = gems
						trade_goods = tropical_wood
						trade_goods = glass
						trade_goods = chinaware
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 16 }
					}
					add_building = mills
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					has_dlc = "Rule Britannia"
					trade_goods = coal
				}
				if = {
					limit = {
						ROOT = { adm_tech = 21 }
					}
					add_building = furnace
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
		}
		else = {
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
	}
}

## create or add a CoT
### create_or_add_center_of_trade_level = { level = <number> }
create_or_add_center_of_trade_level = {
	if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				check_variable = { which = var value = 1 }
			}
		}
		if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 1 }
			}
			center_of_trade = $level$
		}
		else_if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 2 }
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = { which = var value = 2 }
					}
				}
				add_center_of_trade_level = 2
			}
			else = {
				add_center_of_trade_level = 1
			}
		}
		else_if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 3 }
			}
			add_center_of_trade_level = 1
		}
		else = {
			add_base_production = 2
		}
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				NOT = { check_variable = { which = var value = 0 } }
			}
		}
		if = {
			limit = {
				province_has_center_of_trade_of_level = 3
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = { which = var value = -1 }
					}
				}
				add_center_of_trade_level = -1
			}
			else = {
				add_center_of_trade_level = -2
			}
		}
		else_if = {
			limit = {
				province_has_center_of_trade_of_level = 2
			}
			add_center_of_trade_level = -1
		}
	}
}

## replace a province modifier with another
### replace_province_modifier = { remove = test_modifier_1 add = test_modifier_2 time = -1 permanent = yes }
replace_province_modifier = {
	if = {
		limit = {
			has_province_modifier = $remove$
		}
		custom_tooltip = tt_replace_modifier_$remove$_with_$add$
		hidden_effect = {
			remove_province_modifier = $remove$
			if = {
				limit = {
					always = $permanent$
				}
				add_permanent_province_modifier = {
					name = $add$
					duration = $time$
				}
			}
			else = {
				add_province_modifier = {
					name = $add$
					duration = $time$
				}
			}
		}
	}
	else = {
		if = {
			limit = {
				always = $permanent$
			}
			add_permanent_province_modifier = {
				name = $add$
				duration = $time$
			}
		}
		else = {
			add_province_modifier = {
				name = $add$
				duration = $time$
			}
		}
	}
}

#Add from 1 to 6 develop in province[s] based on the Monarch's Skill
# add_development_scaled_on_monarch_skill = yes
add_development_scaled_on_monarch_skill = {
	custom_tooltip = ME_ADD_DEV_TT
	if = {
		limit = {
			owner = { ADM = 6 }
		}
		add_base_tax = 6
	}
	else_if = {
		limit = {
			owner = { ADM = 5 }
		}
		add_base_tax = 5
	}
	else_if = {
		limit = {
			owner = { ADM = 4 }
		}
		add_base_tax = 4
	}
	else_if = {
		limit = {
			owner = { ADM = 3 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { ADM = 2 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { ADM = 1 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { DIP = 6 }
		}
		add_base_production = 6
	}
	else_if = {
		limit = {
			owner = { DIP = 5 }
		}
		add_base_production = 5
	}
	else_if = {
		limit = {
			owner = { DIP = 4 }
		}
		add_base_production = 4
	}
	else_if = {
		limit = {
			owner = { DIP = 3 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { DIP = 2 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { DIP = 1 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { MIL = 6 }
		}
		add_base_manpower = 6
	}
	else_if = {
		limit = {
			owner = { MIL = 5 }
		}
		add_base_manpower = 5
	}
	else_if = {
		limit = {
			owner = { MIL = 4 }
		}
		add_base_manpower = 4
	}
	else_if = {
		limit = {
			owner = { MIL = 3 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { MIL = 2 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { MIL = 1 }
		}
		add_base_manpower = 1
	}
}

#Add from 1 to 6 develop in province[s] based on the Monthly Monarch Power Gained
# add_development_scaled_on_monthly_monarch_power = yes
add_development_scaled_on_monthly_monarch_power = {
	custom_tooltip = ME_ADD_DEV_MONTHLY_TT
	if = {
		limit = {
			owner = { monthly_adm = 17 }
		}
		add_base_tax = 6
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 14 }
		}
		add_base_tax = 5
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 11 }
		}
		add_base_tax = 4
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 8 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 5 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 2 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { monthly_dip = 17 }
		}
		add_base_production = 6
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 14 }
		}
		add_base_production = 5
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 11 }
		}
		add_base_production = 4
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 8 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 5 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 2 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { monthly_mil = 17 }
		}
		add_base_manpower = 6
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 14 }
		}
		add_base_manpower = 5
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 11 }
		}
		add_base_manpower = 4
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 8 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 5 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 2 }
		}
		add_base_manpower = 1
	}
}

#Add from 1 to 3 develop in province[s] based on the Monarch's Skill
# add_development_half_monarch_skill = yes
add_development_half_monarch_skill = {
	custom_tooltip = ME_ADD_HALF_DEV_TT
	if = {
		limit = {
			owner = { ADM = 6 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { ADM = 4 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { ADM = 2 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { DIP = 6 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { DIP = 4 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { DIP = 2 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { MIL = 6 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { MIL = 4 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { MIL = 2 }
		}
		add_base_manpower = 1
	}
}

#Add from 1 to 3 develop in province[s] based on the Monthly Monarch Power Gained
# add_development_half_monthly_monarch_power = yes
add_development_half_monthly_monarch_power = {
	custom_tooltip = ME_ADD_HALF_DEV_MONTHLY_TT
	if = {
		limit = {
			owner = { monthly_adm = 17 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 11 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 5 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { monthly_dip = 17 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 11 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 5 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { monthly_mil = 17 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 11 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 5 }
		}
		add_base_manpower = 1
	}
}

#Add from 1 to 2 develop in province[s] based on the Monarch's Skill
# add_development_third_monarch_skill = yes
add_development_third_monarch_skill = {
	custom_tooltip = ME_ADD_THIRD_DEV_TT
	if = {
		limit = {
			owner = { ADM = 6 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { ADM = 3 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { DIP = 6 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { DIP = 3 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { MIL = 6 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { MIL = 3 }
		}
		add_base_manpower = 1
	}
}

#Add from 1 to 2 develop in province[s] based on the Monthly Monarch Power Gained
# add_development_third_monthly_monarch_power = yes
add_development_third_monthly_monarch_power = {
	custom_tooltip = ME_ADD_THIRD_DEV_MONTHLY_TT
	if = {
		limit = {
			owner = { monthly_adm = 14 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 8 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { monthly_dip = 14 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 8 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { monthly_mil = 14 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 8 }
		}
		add_base_manpower = 1
	}
}

## add/remove <value> papal influence, church power, etc.
### change_religious_influence_equivalent = { add = <number> }
### change_religious_influence_equivalent = { remove = <number> }
### value MUST be positive
change_religious_influence_equivalent = {
	[[add]
		add_papal_influence = $add$
		add_church_power = $add$
		add_fervor = $add$
		add_patriarch_authority = 0.$add$
		add_doom = $add$
		add_karma = $add$
		add_authority = $add$
		add_piety = 0.$add$
		if = {
			limit = {
				religion = confucianism
			}
			add_harmony = $add$
		}
		else = {
			hidden_effect = {
				add_harmony = $add$	# just in case any other religion might use harmony, it's added without a tooltip
			}
		}
	]
	[[remove]
		add_papal_influence = -$remove$
		add_church_power = -$remove$
		add_fervor = -$remove$
		add_patriarch_authority = -0.$remove$
		add_doom = -$remove$
		add_karma = -$remove$
		add_authority = -$remove$
		add_piety = -0.$remove$
		if = {
			limit = {
				religion = confucianism
			}
			add_harmony = -$remove$
		}
		else = {
			hidden_effect = {
				add_harmony = -$remove$	# just in case any other religion might use harmony, it's removed without a tooltip
			}
		}
	]
}

## replace a country modifier with another
### replace_country_modifier = { remove = test_modifier_1 add = test_modifier_2 time = -1 }
replace_country_modifier = {
	if = {
		limit = {
			has_country_modifier = $remove$
		}
		custom_tooltip = tt_replace_modifier_$remove$_with_$add$
		hidden_effect = {
			remove_country_modifier = $remove$
			add_country_modifier = {
				name = $add$
				duration = $time$
			}
		}
	}
	else = {
		add_country_modifier = {
			name = $add$
			duration = $time$
		}
	}
}

## release subjects and collapse nation
### release_subjects_and_cede_cores = { who = ROOT release_subjects = yes rebels = yes }
### "release_subjects" and "rebels" are optional
### must be used in the same scope as "who", "who" is used for some in-effect scopes, so only ROOT, FROM and direct tags/event targets work
release_subjects_and_cede_cores = {
	[[release_subjects]
		if = {
			limit = {
				always = $release_subjects$
			}
			release_all_subjects = yes
		}
	]
	custom_tooltip = RELEASE_SUBJECTS_AND_CEDE_CORES_CEDE_CORES_TT
	hidden_effect = {
		every_owned_province = {
			limit = {
				is_capital = no
				any_core_country = {
					NOT = { tag = $who$ }
				}
			}
			random_core_country = {
				limit = {
					NOT = { tag = $who$ }
				}
				hidden_effect = {
					if = {
						limit = {
							exists = no
						}
						set_country_flag = core_country_not_exists
					}
				}
				PREV = { cede_province = PREV }
				hidden_effect = {
					if = {
						limit = {
							has_country_flag = core_country_not_exists
						}
						clr_country_flag = core_country_not_exists
						change_government = monarchy
						add_government_reform = feudalism_reform
					}
				}
			}
		}
	}
	custom_tooltip = RELEASE_SUBJECTS_AND_CEDE_CORES_GAIN_UNREST_TT
	hidden_effect = {
		every_owned_province = {
			limit = {
				OR = {
					is_capital = yes
					NOT = {
						any_core_country = {
							NOT = { tag = $who$ }
						}
					}
				}
			}
			if = {
				limit = {
					any_country = {
						NOT = { tag = $who$ }
						primary_culture = PREV
					}
				}
				random_country = {
					limit = {
						NOT = { tag = $who$ }
						primary_culture = PREV
					}
					PREV = { add_core = PREV }
				}
			}
			add_unrest = 25
			add_nationalism = 10
			[[rebels]
				if = {
					limit = {
						always = $rebels$
						is_capital = no
					}
					nationalist_rebels = 1
				}
			]
		}
	}
	[[rebels]
		if = {
			limit = {
				always = $rebels$
			}
			custom_tooltip = RELEASE_SUBJECTS_AND_CEDE_CORES_SPAWN_REBELS_TT
		}
	]
}

## adds prestige until 100 is reached and then adds the rest as a random monarch power
### add_prestige_or_monarch_power = { amount = <number> }
add_prestige_or_monarch_power = {
	tooltip = {
		add_prestige = $amount$
	}
	custom_tooltip = ME_ADD_PRESTIGE_OR_MONARCHPOWER
	hidden_effect = {
		for = {
			amount = $amount$
			effect = "
				if = {
					limit = {
						NOT = { prestige = 100 }
					}
					add_prestige = 1
				}
				else = {
					add_adm_power = 1
					add_dip_power = 1
					add_mil_power = 1
				}
			"
		}
	}
}

## adds army tradition until 100 is reached and then adds the rest as mil power
### add_prestige_or_monarch_power = { amount = <number> }
add_army_tradition_or_mil_power = {
	tooltip = {
		add_army_tradition = $amount$
	}
	custom_tooltip = ME_ADD_ARMY_TRADITION_OR_MIL_POWER
	hidden_effect = {
		for = {
			amount = $amount$
			effect = "
				if = {
					limit = {
						NOT = { army_tradition = 99.9 }
					}
					add_army_tradition = 1
				}
				else = {
					add_mil_power = 3
				}
			"
		}
	}
}

## breaks the alliance between current scope and who
### break_alliance_with = { who = <scope> }
break_alliance_with = {
	if = {
		limit = {
			alliance_with = $who$
		}
		$who$ = {
			custom_tooltip = BREAK_ALLIANCE_WITH_TT
		}
		hidden_effect = {
			add_rival = $who$
			remove_rival = $who$
		}
	}
}

## adds the specified amount of crown land by reducing the land share of estates
### change_crown_land = { add = <number> }
### change_crown_land = { remove = <number> }
### must use positive numbers!
change_crown_land = {
	[[add]
		change_estate_land_share = {
			estate = all
			share = -$amount$
		}
	]
	[[remove]
		change_estate_land_share = {
			estate = all
			share = $amount$
		}
	]
}

## adds the culture as an accepted culture or 100 dip power
### add_accepted_culture_or_dip_power = { culture = <culture> }
### the custom effect is only able to check for up to 10 culture slots
add_accepted_culture_or_dip_power = {
	tooltip = {
		add_accepted_culture = $culture$
	}
	custom_tooltip = ADD_ACCEPTED_CULTURE_TT
	hidden_effect = {
		if = {
			limit = {
				accepted_culture = $culture$
			}
			add_dip_power = 100
		}
		else_if = {
			limit = {
				primary_culture = $culture$
			}
			add_dip_power = 100
		}
		else_if = {
			limit = {
				num_accepted_cultures = 10
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 11
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 9
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 10
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 8
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 9
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 7
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 8
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 6
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 7
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 5
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 6
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 4
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 5
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 3
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 4
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 2
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 3
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 1
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 2
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				NOT = { num_accepted_cultures = 1 }
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 1
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else = {
			add_dip_power = 100
		}
	}
}

#####################
# 	USAGE
# 	pick_best_tags = {
#		global_trigger = "your global triggers here" OPTIONAL
#		<example>
#		global_trigger = "
#		OR = {
#			continent = europe
#			allied_with = ROOT
#		}"
#		scale = your trigger type here REQUIRED
#		<example>
#		scale = army_size
#		<number of tags here> = yes (supported numbers: 1-3) REQUIRED
#		event_target_name = "your name for event target here> REQUIRED
#		scope = "your scope here> OPTIONAL
#		<example>
#		scope = "every_neighbor_country"
#		default is every_country
#	}
#####################

pick_best_tags = {
	[[scope]
		pick_best_tags_2 = {
			scope = $scope$
			scale = $scale$
			event_target_name = $event_target_name$
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
		set_global_flag = PICK_BEST_TAG_FLAG
	] #curses for not having an [ELSE ] or something.
	if = {
		limit = {
			NOT = { has_global_flag = PICK_BEST_TAG_FLAG } #This check is here to prevent the algorithm from being run again after the scoped version was executed
		}
		pick_best_tags_2 = {
			scope = every_country
			scale = $scale$
			event_target_name = $event_target_name$
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
	}
	else = { clr_global_flag = PICK_BEST_TAG_FLAG }
}

pick_best_tags_2 = {
	hidden_effect = {
		[[1]
			if = {
				limit = { always = $1$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
			}
		]
		[[2]
			if = {
				limit = { always = $2$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
			}
		]
		[[3]
			if = {
				limit = { always = $3$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
			}
		]
		[[4]
			if = {
				limit = { always = $4$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
			}
		]
		[[5]
			if = {
				limit = { always = $5$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
			}
		]
		[[10]
			if = {
				limit = { always = $10$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 7
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 8
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 9
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 10
				}
			}
		]
		$scope$ = {
			limit = {
				has_country_flag = $event_target_name$_exclude
			}
			clr_country_flag = $event_target_name$_exclude
		}
	}
}

pick_best_tag = {
	1 = { save_event_target_as = $event_target_name$_$number$ }
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			$scale$ = event_target:$event_target_name$_$number$
			NOT = { has_country_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	event_target:$event_target_name$_$number$ = {
		set_country_flag = $event_target_name$_exclude
	}
}

#####################
# 	USAGE
# 	pick_best_provinces = {
#		global_trigger = "your global triggers here" OPTIONAL
#		<example>
#		global_trigger = "
#		OR = {
#			continent = europe
#			allied_with = ROOT
#		}"
#		scale = your trigger type here REQUIRED
#		<example> scale = army_size
#		<number of provinces here> = yes (supported numbers: 1-3) REQUIRED
#		event_target_name = "your name for event target here> REQUIRED
#		scope = <Your scope here> (default: every_province)
#	}
#####################

pick_best_provinces = {
	[[scope]
		pick_best_provinces_2 = {
			scope = "$scope$"
			scale = "$scale$"
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
		set_global_flag = PICK_BEST_PROVINCES_FLAG
	] #curses for not having an [ELSE ] or something.
	if = {
		limit = {
			NOT = { has_global_flag = PICK_BEST_PROVINCES_FLAG } #This check is here to prevent the algorithm from being run again after the scoped version was executed
		}
		pick_best_provinces_2 = {
			scope = " every_province "
			scale = "$scale$"
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
	}
	else = { clr_global_flag = PICK_BEST_PROVINCES_FLAG }
}

pick_best_provinces_2 = {
	hidden_effect = {
		[[1]
			if = {
				limit = { always = $1$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
			}
		]
		[[2]
			if = {
				limit = { always = $2$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
			}
		]
		[[3]
			if = {
				limit = { always = $3$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
			}
		]
		[[4]
			if = {
				limit = { always = $4$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
			}
		]
		[[5]
			if = {
				limit = { always = $5$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
			}
		]
		[[10]
			if = {
				limit = { always = $10$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 7
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 8
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 9
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 10
				}
			}
		]
		$scope$ = {
			limit = {
				has_province_flag = $event_target_name$_exclude
			}
			clr_province_flag = $event_target_name$_exclude
		}
	}
}

pick_best_province = {
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			NOT = { has_province_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			$scale$ = event_target:$event_target_name$_$number$
			NOT = { has_province_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	event_target:$event_target_name$_$number$ = {
		set_province_flag = $event_target_name$_exclude
	}
}
#####
# FOR LOOP
# Executes the $effect$ $amount$ of times.
# for = {
#	amount = 5
#	effect = "
#	random_owned_province = {
#		add_base_tax = 1
#	}
#	"
# }
#####


for = {
	set_variable = {
		which = ForLoopCounter
		value = $amount$
	}

	while = {
		limit = {
			check_variable = {
				which = ForLoopCounter
				value = 1
			}
		}
		$effect$
		subtract_variable = {
			which = ForLoopCounter
			value = 1
		}
	}
}

######
# Define Foreign Advisor
# Automates the process of defining an advisor's culture and religion based on a foreign province
# Accepts the regular variables of define_advisor + uses province IDs for culture and religion variables
# define_foreign_advisor = {
#	type = recruit_master etc. optional
#	skill = 3 etc. optional
# 	name = "Giovanni Battista" optional
#	cost_multiplier = 0.25 optional
#	culture = province_id of origin
#	religion = province_id of origin
#	female = no optional
# }
#########

define_foreign_advisor = {
	hidden_effect = {
		export_to_variable = {
			which = cultureOrigin
			value = culture
			[[culture] who = $culture$ ]
		}
		export_to_variable = {
			which = religionOrigin
			value = religion
			[[religion] who = $religion$ ]
		}
		define_advisor = {
			[[type] type = $type$ ]
			[[name] name = "$name$" ]
			[[skill] skill = $skill$ ]
			culture = variable:cultureOrigin
			religion = variable:religionOrigin
			[[cost_multiplier] cost_multiplier = $cost_multiplier$ ]
			[[female] female = $female$ ]
		}
	}
	tooltip = {
		define_advisor = {
			[[type] type = $type$ ]
			[[name] name = "$name$" ]
			[[skill] skill = $skill$ ]
			[[cost_multiplier] cost_multiplier = $cost_multiplier$ ]
			[[female] female = $female$ ]
		}
	}
	$culture$ = {
		$religion$ = {
			custom_tooltip = ME_advisor_originates_from_PREV_THIS
		}
	}
}

#########
# add_mana_scaled_on_monarch_skill = yes
add_mana_scaled_on_monarch_skill = {
	custom_tooltip = ME_ADD_MANA_TT
	if = {
		limit = { ADM = 6 }
		add_adm_power = 120
	}
	else_if = {
		limit = { ADM = 5 }
		add_adm_power = 100
	}
	else_if = {
		limit = { ADM = 4 }
		add_adm_power = 80
	}
	else_if = {
		limit = { ADM = 3 }
		add_adm_power = 60
	}
	else_if = {
		limit = { ADM = 2 }
		add_adm_power = 40
	}
	else = {
		add_adm_power = 20
	}
	if = {
		limit = { DIP = 6 }
		add_dip_power = 120
	}
	else_if = {
		limit = { DIP = 5 }
		add_dip_power = 100
	}
	else_if = {
		limit = { DIP = 4 }
		add_dip_power = 80
	}
	else_if = {
		limit = { DIP = 3 }
		add_dip_power = 60
	}
	else_if = {
		limit = { DIP = 2 }
		add_dip_power = 40
	}
	else = {
		add_dip_power = 20
	}
	if = {
		limit = { MIL = 6 }
		add_mil_power = 120
	}
	else_if = {
		limit = { MIL = 5 }
		add_mil_power = 100
	}
	else_if = {
		limit = { MIL = 4 }
		add_mil_power = 80
	}
	else_if = {
		limit = { MIL = 3 }
		add_mil_power = 60
	}
	else_if = {
		limit = { MIL = 2 }
		add_mil_power = 40
	}
	else = {
		add_mil_power = 20
	}
}

#add_mana_scaled_on_monthly_monarch_power = yes
add_mana_scaled_on_monthly_monarch_power = {
	custom_tooltip = ME_ADD_MANA_MONTHLY_TT
	if = {
		limit = { monthly_adm = 17 }
		add_adm_power = 120
	}
	else_if = {
		limit = { monthly_adm = 14 }
		add_adm_power = 100
	}
	else_if = {
		limit = { monthly_adm = 11 }
		add_adm_power = 80
	}
	else_if = {
		limit = { monthly_adm = 8 }
		add_adm_power = 60
	}
	else_if = {
		limit = { monthly_adm = 5 }
		add_adm_power = 40
	}
	else = {
		add_adm_power = 20
	}
	if = {
		limit = { monthly_dip = 17 }
		add_dip_power = 120
	}
	else_if = {
		limit = { monthly_dip = 14 }
		add_dip_power = 100
	}
	else_if = {
		limit = { monthly_dip = 11 }
		add_dip_power = 80
	}
	else_if = {
		limit = { monthly_dip = 8 }
		add_dip_power = 60
	}
	else_if = {
		limit = { monthly_dip = 5 }
		add_dip_power = 40
	}
	else = {
		add_dip_power = 20
	}
	if = {
		limit = { monthly_mil = 17 }
		add_mil_power = 120
	}
	else_if = {
		limit = { monthly_mil = 14 }
		add_mil_power = 100
	}
	else_if = {
		limit = { monthly_mil = 11 }
		add_mil_power = 80
	}
	else_if = {
		limit = { monthly_mil = 8 }
		add_mil_power = 60
	}
	else_if = {
		limit = { monthly_mil = 5 }
		add_mil_power = 40
	}
	else = {
		add_mil_power = 20
	}
}

change_national_focus_effect = {
	if = {
		limit = {
			OR = {
				has_dlc = "Res Publica"
				has_dlc = "Common Sense"
			}
		}
		custom_tooltip = ME_CHANGE_NATIONAL_FOCUS_TT
		hidden_effect = {
			country_event = { id = missions_expanded_events.2 }
		}
	}
}

set_defender_of_the_faith_effect = {
	if = {
		limit = {
			OR = {
				religion_group = christian
				religion_group = muslim
			}
		}
		custom_tooltip = ME_SET_DEFENDER_OF_FAITH_TT
		hidden_effect = {
			country_event = { id = missions_expanded_events.4 }
		}
	}
}

create_general_with_pips = {
	create_general = {
		tradition = $tradition$
		[[add_fire] add_fire = $add_fire$ ]
		[[add_shock] add_shock = $add_shock$ ]
		[[add_manuever] add_manuever = $add_manuever$ ]
		[[add_siege] add_siege = $add_siege$ ]
		[[name] name = $name$ ]
		[[culture] culture = $culture$ ]
	}
	custom_tooltip = ME_GENERAL_$add_fire$_$add_shock$_$add_manuever$_$add_siege$
}

ME_give_province_claims = {
	$id$ = {
		if = {
			limit = {
				NOT = { is_core = $tag$ }
				NOT = { is_permanent_claim = $tag$ }
			}
			add_permanent_claim = $tag$
		}
	}
}

ME_give_area_claims = {
	$group$ = {
		limit = {
			NOT = { is_core = $tag$ }
			NOT = { is_permanent_claim = $tag$ }
		}
		add_permanent_claim = $tag$
	}
}

ME_give_claims = {
	[[province]
		ME_give_province_claims = { id = $province$ tag = ROOT }
	]
	[[id]
		ME_give_province_claims = { id = $id$ tag = ROOT }
	]
	[[area]
		ME_give_area_claims = { group = $area$ tag = ROOT }
	]
	[[region]
		ME_give_area_claims = { group = $region$ tag = ROOT }
	]

}

ME_add_years_of_trade_income = {
	[[years] add_years_of_trade_income = { years = $years$ custom_tooltip = ME_add_$years$_years_of_trade_income } ]
	[[value] add_years_of_trade_income = { years = $value$ custom_tooltip = ME_add_$value$_years_of_trade_income } ]
	[[amount] add_years_of_trade_income = { years = $amount$ custom_tooltip = ME_add_$amount$_years_of_trade_income } ]
}

add_positive_or_negative_piety = {
	if = {
		limit = {
			piety = 0
		}
		add_piety = $amount$
	}
	else = {
		add_piety = -$amount$
	}
}

ME_technology_split_120_power = { #placeholder, I will put the implementation here later!
	custom_tooltip = "ME_split_120_MP"
	hidden_effect = {
		export_to_variable = {
			which = MSA_our_adm_tech
			value = adm_tech
		}
		export_to_variable = {
			which = MSA_our_dip_tech
			value = dip_tech
		}
		export_to_variable = {
			which = MSA_our_mil_tech
			value = mil_tech
		}
		set_variable = {
			which = MSA_our_lowest_tech
			which = MSA_our_adm_tech
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = MSA_our_dip_tech
						which = MSA_our_lowest_tech
					}
				}
			}
			set_variable = {
				which = MSA_our_lowest_tech
				which = MSA_our_dip_tech
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = MSA_our_mil_tech
						which = MSA_our_lowest_tech
					}
				}
			}
			set_variable = {
				which = MSA_our_lowest_tech
				which = MSA_our_mil_tech
			}
		}
		
		subtract_variable = {
			which = MSA_our_adm_tech
			which = MSA_our_lowest_tech
		}
		subtract_variable = {
			which = MSA_our_dip_tech
			which = MSA_our_lowest_tech
		}
		subtract_variable = {
			which = MSA_our_mil_tech
			which = MSA_our_lowest_tech
		}
		
		if = {
			limit = {
				is_variable_equal = {
					which = MSA_our_adm_tech
					value = 0
				}
			}
			if = {
				limit = {
					is_variable_equal = {
						which = MSA_our_dip_tech
						value = 0
					}
				}
				if = {
					limit = {
						is_variable_equal = {
							which = MSA_our_mil_tech
							value = 0
						}
					}
					add_adm_power = 40
					add_dip_power = 40
					add_mil_power = 40
				}
				else = {
					add_adm_power = 60
					add_dip_power = 60
				}
			}
			else = {
				if = {
					limit = {
						is_variable_equal = {
							which = MSA_our_mil_tech
							value = 0
						}
					}
					add_adm_power = 60
					add_mil_power = 60
				}
				else = {
					add_adm_power = 120
				}
			}
		}
		else = {
			if = {
				limit = {
					is_variable_equal = {
						which = MSA_our_dip_tech
						value = 0
					}
				}
				if = {
					limit = {
						is_variable_equal = {
							which = MSA_our_mil_tech
							value = 0
						}
					}
					add_dip_power = 60
					add_mil_power = 60
				}
				else = {
					add_dip_power = 120
				}
			}
			else = {
				add_mil_power = 120
			}
		}
		
		#flush the vars
		set_variable = {
			which = MSA_our_adm_tech
			value = 0
		}
		set_variable = {
			which = MSA_our_dip_tech
			value = 0
		}
		set_variable = {
			which = MSA_our_mil_tech
			value = 0
		}
		set_variable = {
			which = MSA_our_lowest_tech
			value = 0
		}
	}
}

#tag = { ME_add_to_empire = yes }
ME_add_to_empire = {
	custom_tooltip = me_join_the_empire
	if = {
		limit = {
			capital_scope = {
				continent = europe #In case their capital is not in Europe
			}
		}
		tooltip = {
			set_in_empire = yes
		}

		hidden_effect = {
			every_owned_province = {
				limit = {
					continent = europe
				}
				set_in_empire = yes
			}
			set_country_flag = reined_in_for_shadow_kingdom #in case that happens
		}
	}
}

# ME_distribute_development = {
#	type = x //The 3 development types. E.G. type = production
#	amount = x //How many development to add. E.G amount = 10
#	limit = " " OPTIONAL //takes actual triggers. E.G. limit = " NOT = { culture = ROOT } "
#}
ME_distribute_development = {
	hidden_effect = {
		set_variable = {
			which = ME_$type$_loop
			value = 0
		}
		while = {
			limit = {
				NOT = {
					check_variable = {
						which = ME_$type$_loop
						value = $amount$
					}
				}
			}
			random_owned_province = {
				limit = {
					[[limit] $limit$ ]
				}
				add_base_$type$ = 1
			}
			change_variable = {
				which = ME_$type$_loop
				value = 1
			}
		}
	}
	custom_tooltip = $type$_$amount$
}

# ME_remove_development_distributed = {
#	type = x //The 3 development types. E.G. type = production
#	amount = x //How many development to add. E.G amount = 10
#	limit = " " OPTIONAL //takes actual triggers. E.G. limit = " NOT = { culture = ROOT } "
#}
ME_remove_development_distributed = {
	hidden_effect = {
		set_variable = {
			which = ME_$type$_loop
			value = 0
		}
		while = {
			limit = {
				NOT = {
					check_variable = {
						which = ME_$type$_loop
						value = $amount$
					}
				}
			}
			random_owned_province = {
				limit = {
					[[limit] $limit$ ]
					base_$type$ = 2 #In case the province has 1 development of that type
				}
				add_base_$type$ = -1
			}
			change_variable = {
				which = ME_$type$_loop
				value = 1
			}
		}
	}
	custom_tooltip = remove_$type$_$amount$
}

#ME_country_event_delay = { id = x }
#Done for some small flavor
#Will let Stiopa make the final verdict
#ME_country_event_delay = {
#	hidden_effect = {
#		country_event = { id = $id$ days = 1 }
#	}
#	tooltip = {
#		country_event = { id = $id$ }
#	}
#}

disable_annex_penalty = {
	custom_tooltip = ME_disble_annex_penalty_for_annexing_root
	set_country_flag = ME_causes_no_annexation_penalty
}

ME_override_country_name = {
	[[country_name] override_country_name = $country_name$ ]
	[[name] override_country_name = $name$ ]
	[[country] override_country_name = $country$ ]
	[[value] override_country_name = $value$ ]
	[[string] override_country_name = $string$ ]
	hidden_effect = {
		set_country_flag = ME_overrid_country_name
	}
}

#ME_add_scaling_adm_advisor_bonuses = yes
ME_add_scaling_adm_advisor_bonuses = {
	custom_tooltip = me_mug_adm_advisors_give_scaling_bonuses
	set_country_flag = me_mug_scaling_advisors
}

#ME_add_scaling_dip_advisor_bonuses = yes
ME_add_scaling_dip_advisor_bonuses = {
	custom_tooltip = me_mug_dip_advisors_give_scaling_bonuses
	set_country_flag = me_mug_scaling_advisors_dip
}

#ME_add_scaling_mil_advisor_bonuses = yes
ME_add_scaling_mil_advisor_bonuses = {
	custom_tooltip = me_mug_mil_advisors_give_scaling_bonuses
	set_country_flag = me_mug_scaling_advisors_mil
}

ME_add_power_projection = {
	[[amount]
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = $amount$
		}
	]
	[[value]
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = $value$
		}
	
	]
}

#Polish Scripted Effects
transfer_ZAZ_province = {
	if = {
		limit = {
			is_core = ROOT
		}
		add_core = ZAZ
	}
	if = {
		limit = {
			country_or_non_sovereign_subject_holds = ROOT
		}
		owner = {
			if = {
				limit = {
					NOT = { tag = ZAZ }
					is_subject_of = ROOT
				}
				add_liberty_desire = 10
			}
		}
		cede_province = ZAZ
	}
}

#Trade Outpost Scripted Effects
#########	Hanseatic Outposts	#########
create_hanseatic_outpost = {
	custom_tooltip = HNS_make_a_kontor
	hidden_effect = {
		add_province_triggered_modifier = HNS_kontor
		add_permanent_province_modifier = {
			name = HNS_icon_gray
			duration = -1
			hidden = yes
		}
		clr_province_flag = HNS_activated
		set_province_flag = HNS_deactivated
	}
}

upgrade_hanseatic_outpost = {
	custom_tooltip = HNS_upgrade_kontor
	hidden_effect = {
		set_province_flag = HNS_upgraded
		if = {
			limit = {
				has_trade_modifier = {
					who = event_target:target_HANSA
					key = HNS_ties
				}
			}
			remove_trade_modifier = {
				who = event_target:target_HANSA
				key = HNS_ties
			}
			add_trade_modifier = {
				who = event_target:target_HANSA
				duration = -1
				power = 30
				key = HNS_ties
			}
		}
	}
}

remove_hanseatic_outpost = {
	custom_tooltip = HNS_benefits_of_outpost
	hidden_effect = {
		remove_province_triggered_modifier = HNS_kontor
		remove_province_modifier = HNS_icon_gray
		remove_province_modifier = HNS_icon
	}
}

destroy_hanseatic_outpost = {
	remove_province_triggered_modifier = HNS_kontor
	remove_province_modifier = HNS_icon_gray
	remove_province_modifier = HNS_icon
	if = {
		limit = {
			has_trade_modifier = {
				who = event_target:target_HANSA
				key = HNS_ties
			}
		}
		remove_trade_modifier = {
			who = event_target:target_HANSA
			key = HNS_ties
		}
	}
	clr_province_flag = HNS_upgraded
	clr_province_flag = HNS_deactivated
	clr_province_flag = HNS_activated
}

##########	Silk Route	#########
create_silk_route_outpost = {
	custom_tooltip = silk_route_make_a_kontor
	hidden_effect = {
		add_province_triggered_modifier = silk_route_kontor
		add_permanent_province_modifier = {
			name = silk_route_icon_gray
			duration = -1
			hidden = yes
		}
		clr_province_flag = silk_route_activated
		set_province_flag = silk_route_deactivated
	}
}

upgrade_silk_route_outpost = {
	custom_tooltip = silk_route_upgrade_kontor
	hidden_effect = {
		set_province_flag = silk_route_upgraded
		if = {
			limit = {
				has_trade_modifier = {
					who = event_target:target_silk_route
					key = silk_route_ties
				}
			}
			remove_trade_modifier = {
				who = event_target:target_silk_route
				key = silk_route_ties
			}
			add_trade_modifier = {
				who = event_target:target_silk_route
				duration = -1
				power = 30
				key = silk_route_ties
			}
		}
	}
}

remove_silk_route_outpost = {
	custom_tooltip = silk_route_benefits_of_outpost
	hidden_effect = {
		remove_province_triggered_modifier = silk_route_kontor
		remove_province_modifier = silk_route_icon_gray
		remove_province_modifier = silk_route_icon
	}
}

destroy_silk_route_outpost = {
	remove_province_triggered_modifier = silk_route_kontor
	remove_province_modifier = silk_route_icon_gray
	remove_province_modifier = silk_route_icon
	if = {
		limit = {
			has_trade_modifier = {
				who = event_target:target_silk_route
				key = silk_route_ties
			}
		}
		remove_trade_modifier = {
			who = event_target:target_silk_route
			key = silk_route_ties
		}
	}
	clr_province_flag = silk_route_upgraded
	clr_province_flag = silk_route_deactivated
	clr_province_flag = silk_route_activated
}

#Westphalian Scripted Effects
#all the code in this file? Never again. I experienced this ONCE, and that is enough for me. This is Missions Expanded, not bloody overhaul. Too much work for this

#this was a good idea, unfortunately I realise that half of it was flawed from the beginning too late.

#don't check this for your own sanity.

WES_give_every_target_reduction = {
	WES_every_target = {
		effect = "
			change_variable = {
				which = Westphalia_AdvisorCost
				value = $amount$
			}
		"
	}
}

WES_every_target = {
	event_target:Westphalia_Target_1 = { $effect$ }
	event_target:Westphalia_Target_2 = { $effect$ }
	event_target:Westphalia_Target_3 = { $effect$ }
	event_target:Westphalia_Target_4 = { $effect$ }
	event_target:Westphalia_Target_5 = { $effect$ }
}

WES_give_specific_target_reduction = {
	[[target]
		event_target:$target$ = {
			change_variable = {
				which = Westphalia_AdvisorCost
				value = $amount$
			}
		}
	]
}

WES_every_target_opinion_evaluation = {
	WES_every_target = { #there was beautiful code here but length limitations 
		effect = "
			WES_opinion_evaluation = yes
		"
	}
}

WES_opinion_evaluation = {
	if = {
		limit = {
			has_opinion = {
				who = ROOT
				value = 25
			}
		}
		if = {
			limit = {
				has_opinion = {
					who = ROOT
					value = 50
				}
			}
			if = {
				limit = {
					has_opinion = {
						who = ROOT
						value = 75
					}
				}
				if = {
					limit = {
						has_opinion = {
							who = ROOT
							value = 100
						}
					}
					if = {
						limit = {
							has_opinion = {
								who = ROOT
								value = 125
							}
						}
						if = {
							limit = {
								has_opinion = {
									who = ROOT
									value = 150
								}
							}
							if = {
								limit = {
									has_opinion = {
										who = ROOT
										value = 175
									}
								}
								if = {
									limit = {
										has_opinion = {
											who = ROOT
											value = 200
										}
									}
									change_variable = {
										which = Westphalia_AdvisorCost
										value = 5
									}
								}
								change_variable = {
									which = Westphalia_AdvisorCost
									value = 5
								}
							}
							change_variable = {
								which = Westphalia_AdvisorCost
								value = 5
							}
						}
						change_variable = {
							which = Westphalia_AdvisorCost
							value = 5
						}
					}
					change_variable = {
						which = Westphalia_AdvisorCost
						value = 5
					}
				}
				change_variable = {
					which = Westphalia_AdvisorCost
					value = 5
				}
			}
			change_variable = {
				which = Westphalia_AdvisorCost
				value = 5
			}
		}
		change_variable = {
			which = Westphalia_AdvisorCost
			value = 5
		}
	}
}

WES_assign_reduction_based_on_tolerance = {
	WES_every_target = {
		effect = "
			WES_tolerance_evaluation = yes
		"
	}
}

WES_tolerance_evaluation = {
	if = {
		limit = {
			ROOT = {
				religion_group = PREV
			}
		}
		if = {
			limit = {
				ROOT = {
					religion = PREV
				}
			}
			if = {
				limit = {
					ROOT = {
						has_global_modifier_value = {
							which = tolerance_own
							value = 1
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							has_global_modifier_value = {
								which = tolerance_own
								value = 2
							}
						}
					}
					if = {
						limit = {
							ROOT = {
								has_global_modifier_value = {
									which = tolerance_own
									value = 3
								}
							}
						}
						change_variable = {
							which = Westphalia_AdvisorCost
							value = 5
						}
					}
					change_variable = {
						which = Westphalia_AdvisorCost
						value = 5
					}
				}
				change_variable = {
					which = Westphalia_AdvisorCost
					value = 5
				}
			}
		}
		else = {
			if = {
				limit = {
					ROOT = {
						has_global_modifier_value = {
							which = tolerance_heretic
							value = 1
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							has_global_modifier_value = {
								which = tolerance_heretic
								value = 2
							}
						}
					}
					if = {
						limit = {
							ROOT = {
								has_global_modifier_value = {
									which = tolerance_heretic
									value = 3
								}
							}
						}
						change_variable = {
							which = Westphalia_AdvisorCost
							value = 5
						}
					}
					change_variable = {
						which = Westphalia_AdvisorCost
						value = 5
					}
				}
				change_variable = {
					which = Westphalia_AdvisorCost
					value = 5
				}
			}
		}
	}
	else = {
		if = {
			limit = {
				ROOT = {
					has_global_modifier_value = {
						which = tolerance_heathen
						value = 1
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						has_global_modifier_value = {
							which = tolerance_heathen
							value = 2
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							has_global_modifier_value = {
								which = tolerance_heathen
								value = 3
							}
						}
					}
					change_variable = {
						which = Westphalia_AdvisorCost
						value = 5
					}
				}
				change_variable = {
					which = Westphalia_AdvisorCost
					value = 5
				}
			}
			change_variable = {
				which = Westphalia_AdvisorCost
				value = 5
			}
		}
	}
}

#Oh, I hate the one below the most. Simply brilliant.
WES_pick_an_advisor = {
	if = {
		limit = {
			check_variable = {
				which = Westphalia_AdvisorCost
				value = 5
			}
		}
		if = {
			limit = {
				check_variable = {
					which = Westphalia_AdvisorCost
					value = 10
				}
			}
			if = {
				limit = {
					check_variable = {
						which = Westphalia_AdvisorCost
						value = 15
					}
				}
				if = {
					limit = {
						check_variable = {
							which = Westphalia_AdvisorCost
							value = 20
						}
					}
					if = {
						limit = {
							check_variable = {
								which = Westphalia_AdvisorCost
								value = 25
							}
						}
						if = {
							limit = {
								check_variable = {
									which = Westphalia_AdvisorCost
									value = 30
								}
							}
							if = {
								limit = {
									check_variable = {
										which = Westphalia_AdvisorCost
										value = 35
									}
								}
								if = {
									limit = {
										check_variable = {
											which = Westphalia_AdvisorCost
											value = 40
										}
									}
									if = {
										limit = {
											check_variable = {
												which = Westphalia_AdvisorCost
												value = 45
											}
										}
										if = {
											limit = {
												check_variable = {
													which = Westphalia_AdvisorCost
													value = 50
												}
											}
											if = {
												limit = {
													check_variable = {
														which = Westphalia_AdvisorCost
														value = 55
													}
												}
												if = {
													limit = {
														check_variable = {
															which = Westphalia_AdvisorCost
															value = 60
														}
													}
													if = {
														limit = {
															check_variable = {
																which = Westphalia_AdvisorCost
																value = 65
															}
														}
														if = {
															limit = {
																check_variable = {
																	which = Westphalia_AdvisorCost
																	value = 70
																}
															}
															if = {
																limit = {
																	check_variable = {
																		which = Westphalia_AdvisorCost
																		value = 75
																	}
																}
																if = {
																	limit = {
																		check_variable = {
																			which = Westphalia_AdvisorCost
																			value = 80
																		}
																	}
																	if = {
																		limit = {
																			check_variable = {
																				which = Westphalia_AdvisorCost
																				value = 85
																			}
																		}
																		ROOT = {
																			define_advisor = {
																				type = $type$
																				skill = 3
																				culture = PREV
																				religion = PREV
																				cost_multiplier = 0.15
																			}
																		}
																	}
																	else = {
																		ROOT = {
																			define_advisor = {
																				type = $type$
																				skill = 3
																				culture = PREV
																				religion = PREV
																				cost_multiplier = 0.2
																			}
																		}
																	}
																}
																else = {
																	ROOT = {
																		define_advisor = {
																			type = $type$
																			skill = 3
																			culture = PREV
																			religion = PREV
																			cost_multiplier = 0.25
																		}
																	}
																}
															}
															else = {
																ROOT = {
																	define_advisor = {
																		type = $type$
																		skill = 3
																		culture = PREV
																		religion = PREV
																		cost_multiplier = 0.3
																	}
																}
															}
														}
														else = {
															ROOT = {
																define_advisor = {
																	type = $type$
																	skill = 3
																	culture = PREV
																	religion = PREV
																	cost_multiplier = 0.35
																}
															}
														}
													}
													else = {
														ROOT = {
															define_advisor = {
																type = $type$
																skill = 3
																culture = PREV
																religion = PREV
																cost_multiplier = 0.4
															}
														}
													}
												}
												else = {
													ROOT = {
														define_advisor = {
															type = $type$
															skill = 3
															culture = PREV
															religion = PREV
															cost_multiplier = 0.45
														}
													}
												}
											}
											else = {
												ROOT = {
													define_advisor = {
														type = $type$
														skill = 3
														culture = PREV
														religion = PREV
														cost_multiplier = 0.5
													}
												}
											}
										}
										else = {
											ROOT = {
												define_advisor = {
													type = $type$
													skill = 3
													culture = PREV
													religion = PREV
													cost_multiplier = 0.55
												}
											}
										}
									}
									else = {
										ROOT = {
											define_advisor = {
												type = $type$
												skill = 3
												culture = PREV
												religion = PREV
												cost_multiplier = 0.6
											}
										}
									}
								}
								else = {
									ROOT = {
										define_advisor = {
											type = $type$
											skill = 3
											culture = PREV
											religion = PREV
											cost_multiplier = 0.65
										}
									}
								}
							}
							else = {
								ROOT = {
									define_advisor = {
										type = $type$
										skill = 3
										culture = PREV
										religion = PREV
										cost_multiplier = 0.7
									}
								}
							}
						}
						else = {
							ROOT = {
								define_advisor = {
									type = $type$
									skill = 3
									culture = PREV
									religion = PREV
									cost_multiplier = 0.75
								}
							}
						}
					}
					else = {
						ROOT = {
							define_advisor = {
								type = $type$
								skill = 3
								culture = PREV
								religion = PREV
								cost_multiplier = 0.8
							}
						}
					}
				}
				else = {
					ROOT = {
						define_advisor = {
							type = $type$
							skill = 3
							culture = PREV
							religion = PREV
							cost_multiplier = 0.85
						}
					}
				}
			}
			else = {
				ROOT = {
					define_advisor = {
						type = $type$
						skill = 3
						culture = PREV
						religion = PREV
						cost_multiplier = 0.9
					}
				}
			}
		}
		else = {
			ROOT = {
				define_advisor = {
					type = $type$
					skill = 3
					culture = PREV
					religion = PREV
					cost_multiplier = 0.95
				}
			}
		}
	}
	else = {
		ROOT = {
			define_advisor = {
				type = $type$
				skill = 3
				culture = PREV
				religion = PREV
			}
		}
	}
	custom_tooltip = WES_this_depends_on_factors
}

#To be Scripted
pick_random_provinces = {
	[[scope]
		pick_random_provinces_2 = {
			scope = "$scope$"
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
		set_global_flag = PICK_RANDOM_PROVINCES_FLAG
	] #curses for not having an [ELSE ] or something.
	if = {
		limit = {
			NOT = { has_global_flag = PICK_RANDOM_PROVINCES_FLAG } #This check is here to prevent the algorithm from being run again PICK_RANDOM_PROVINCES_FLAG the scoped version was executed
		}
		pick_random_provinces_2 = {
			scope = " every_province "
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
	}
	else = { clr_global_flag = PICK_RANDOM_PROVINCES_FLAG }
}

pick_random_provinces_2 = {
	hidden_effect = {
		[[1]
			if = {
				limit = { always = $1$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
			}
		]
		[[2]
			if = {
				limit = { always = $2$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
			}
		]
		[[3]
			if = {
				limit = { always = $3$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
			}
		]
		[[4]
			if = {
				limit = { always = $4$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
			}
		]
		[[5]
			if = {
				limit = { always = $5$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
			}
		]
		[[6]
			if = {
				limit = { always = $6$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
			}
		]
		[[10]
			if = {
				limit = { always = $10$ }
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 7
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 8
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 9
				}
				pick_random_province = {
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 10
				}
			}
		]
		every_province = {
			limit = {
				has_province_flag = $event_target_name$_exclude
			}
			clr_province_flag = $event_target_name$_exclude
		}
	}
}

pick_random_province = {
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			NOT = { has_province_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	event_target:$event_target_name$_$number$ = {
		set_province_flag = $event_target_name$_exclude
	}
}